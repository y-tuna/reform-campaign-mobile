{
  "rules": [
    {
      "type": "prd",
      "content": "# reform_campaign_spec_v2.2\n\n# 📑 개혁신당 캠페인 매니저 – 풀패키지 기획/명세 문서 (목차 v2.2)\n\n누적 기획 (context) + 0902 회의 + 지도부 인사이트 + 러버블 데모 + GPT 캔버스 UI/기획 기반 GPT 정리\n\n# 목차 v2.2\n\n1. **서비스 기획 (Product Vision & Scope)**\n    - 배경, 목표, 유저 타입, 페르소나, 주요 시나리오\n2. **개발 기능 명세 (Feature & Tech Spec)**\n    - 플랫폼별 기능\n    - 데이터 플로우\n    - API 스펙\n    - 데이터 모델\n3. **정책 기획 (Operational Policies)**\n    - 권한 체계\n    - 운영 정책\n    - 데이터/보안 정책\n4. **로드맵 (Roadmap & Milestones)**\n    - 일정\n    - 리스크\n    - 운영 지표\n5. **사용자 시나리오 (Representative Scenarios)**\n    - 예비후보자 루프\n    - 후보자 루프\n    - 챗봇 → 웹 리다이렉트\n    - 크레딧 루프\n    - 중앙 관리자 시나리오\n6. **스케줄러 운영 규칙 (Scheduler Rules & Scoring)**\n    - 입력 데이터\n    - 우선순위 산식\n    - 모드 전환(예비/후보자)\n    - 중앙 가중치\n7. **데이터 계약 (Front–Back Contracts)**\n    - Task.tertiary / type\n    - Proof.kind\n    - Broadcast.severity\n    - Profile.intensity / mobility / religion_pref\n8. **화이트리스트 & 증빙 정책**\n    - 중앙선관위 지정 품목 화이트리스트\n    - 증빙(사진/영수증) 요건\n    - 심사 기준 (자동 vs 관리자 승인)\n9. **챗봇 구조 (Election-law Q&A)**\n    - 룰베이스 Q&A → 모달 → 웹 리다이렉트\n    - FAQ/사례 기반\n    - 선관위 문서/가이드 연계\n10. **추가 과제 & 확장(Ahead Tasks)**\n- 무한 스크롤, A/B 테스트, POI 데이터 통합, 공보물 발주 자동화\n- 다당제 확장(타 정당 계약 시 구조 확장)\n- 교육 모듈 (출마자 교육/톤앤매너)\n\n---\n\n# 기획 세부\n\n## 1. 서비스 기획 (Product Vision & Scope)\n\n### 1.1 배경\n\n- **정치 캠페인 특수성**\n    - 선거철 실무자는 PC 앞에 앉아 있을 시간이 거의 없음.\n    - 주요 활동은 전화, 인사, 현수막 설치 등 → **현장 즉시성**이 핵심.\n- **개혁신당의 수요**\n    - 이미 “모바일 앱 + 웹 CRM” 요구 명확히 제시.\n    - 이준석 의원실 9/2 미팅에서 **유세 스케줄러**, **공천/공보물 자동화**, **후원·정산**이 핵심 우선순위로 확인됨.\n- **현실적 제약**\n    - 후보자 대부분이 풀타임 캠프 운영이 어려움 → **앱 기반 가이드** 없으면 현장에서 갈피 잃음.\n    - 데이터 관리·분석은 중앙당/관리자 웹에서 처리.\n\n### 1.2 목표\n\n- **모바일 앱 (가칭: 비서AI)**\n    - 기반: React Native + FastAPI (Python BE), 공통 DB(PostgreSQL).\n    - 기능: 오늘의 유세 추천 루트, 활동 기록, 챗봇, 랭킹, 크레딧 표시.\n    - 포인트: **현장성/단순성**, Default ↔ Senior UI 자동 적용.\n- **웹 (가칭: 개혁신당 캠페인)**\n    - 기반: Next.js (FE) + Spring/Python (BE) + PostgreSQL.\n    - 기능: 후보 활동 집계, 대시보드, 공지 푸시, 서류/공보물 검토, 후원 관리.\n    - 포인트: **분석·행정 허브**.\n- **차별성**\n    - 일반 CRM은 단순 연락처/후원 관리에 치중.\n    - 본 서비스는 **“유세 스케줄링 + 자동화된 행정 툴”** 결합으로 후보자의 진입장벽을 낮춤.\n\n### 1.3 유저 타입\n\n- **타입 1: 출마자 (예비후보자·후보자)**\n    - 원칙적으로 **캠프당 1계정**.\n    - 필요 시 사무관 등과 공유 가능하지만 책임은 본인.\n    - 기능: 앱 액션 실행, 증빙 업로드, 웹 서류 제출.\n- **타입 2: 중앙당 관리자**\n    - 역할: 전체 후보 활동 모니터링, 공지/전술 푸시, 정산 집행.\n    - 권한: 후보 데이터 열람, 증빙 승인, 정책 개입.\n\n### 1.4 사용자 페르소나\n\n- **2030 (예비)후보자**\n    - 모바일 친숙, 빠른 루프 필요.\n    - 니즈: 자동 스케줄링, 간단 증빙, 챗봇 기반 가이드.\n- **4050 (예비)후보자**\n    - 데이터·자료 관리 중요.\n    - 니즈: 증빙 확실, 대시보드 통한 활동 피드백.\n- **60+ (예비)후보자**\n    - 단순 UI 필요.\n    - 니즈: 큰 글씨/한 화면에 하나의 액션(Senior 모드).\n- **중앙당 관리자**\n    - 다수 후보 관리, 리스크 차단.\n    - 니즈: 집계 대시보드, 공지 푸시, 규정 준수 모니터링.\n\n### 1.5 주요 시나리오\n\n- **앱 – 예비후보자 루프**\n    - 접속 → 상단 공지 리본 확인 → 자동 생성된 오늘의 루트 요약 확인 → 할 일 카드 실행:\n        - POI 인사 유세 → 시작(트래킹 ON) → 완료(사진/메모) → 증빙 업로드.\n        - 시설/단체 방문 → [열기] → 일정공지/안건 모달 → 필요 시 웹 리다이렉트.\n        - 공천/출마 서류 준비 → 체크리스트 모달 → [제출하러 가기] → 웹 서류 제출.\n        - 유세 물품 구매 → 제휴몰 웹 리다이렉트 → 결제 후 증빙 업로드.\n- **앱 – 후보자 루프 (법정 등록 이후)**\n    - 거점 인사(출·퇴근/상권) 중심 자동 루트 상향.\n    - ETA 배지, 네비게이션 강조.\n    - 중앙 푸시 공지(특정 출구 집중 등) 상단 리본 노출.\n- **앱 – 챗봇**\n    - “선거법 OO 가능?” → 룰베이스 Q&A → 근거 스니펫 → [자세히 보기] → 웹 정책 문서 뷰어.\n    - 체크리스트/가이드 링크도 웹 이동.\n- **앱 – 크레딧 루프**\n    - 온보딩 시 공천금/예산을 크레딧으로 표기(결제X).\n    - 제휴 구매·증빙 업로드 시 크레딧 차감.\n    - 후원금 유입 시 크레딧 가산.\n    - 월말 대시보드 → 수입/지출/증빙 대기 집계.\n- **웹 – 중앙 관리자 시나리오**\n    - 후보자 리스트/상세 뷰.\n    - 공지·전술 푸시 발송.\n    - 서류/증빙 검토 및 승인.\n    - 활동 랭킹 확정 → 상위 일부 크레딧 환급 실행.\n\n## 2. 개발 기능 명세 (Feature & Tech Spec)\n\n### 2.1 전체 시스템 개요\n\n- **앱 (React Native · Expo)**\n    - 역할: 출마자 전용 → 오늘의 유세 루트 실행, 챗봇, 활동 기록, 대시보드\n    - 특징: Default/Senior UI 분기, 하루 자동 스케줄러, 증빙 업로드\n- **웹 (Next.js FE + Java Spring/FastAPI BE)**\n    - 역할: 중앙당 관리자용 → 활동 모니터링, 공천/공보물/후원 관리\n    - 특징: 리스트·테이블 기반, 집계/랭킹, 문서 처리\n- **백엔드 (FastAPI, Python)**\n    - 역할: API 게이트웨이 + 스케줄러 + 챗봇\n    - 특징: RESTful API + JWT 인증, PostgreSQL 연동\n- **DB (PostgreSQL + PostGIS)**\n    - 역할: 모든 데이터의 단일 소스 (유저/과업/POI/증빙/후원/문서)\n    - 특징: GIS 기능 포함, 선거법 준수한 데이터 보존정책 적용\n- **인프라**\n    - 배포: Railway/Render (BE), Vercel (Web), Expo EAS (App)\n    - 데이터 보관: AWS S3 호환 스토리지 (증빙/이미지)\n\n### 2.2 플랫폼별 상세 기능\n\n| 구분 | 모바일 앱 (비서AI) | 웹 (개혁신당 캠페인) |\n| --- | --- | --- |\n| 핵심 | 오늘의 유세(지도+카드), 자동 스케줄러, 활동 기록, 챗봇 | 후보자 관리, 공지 푸시, 대시보드, 서류 검토, 공보물 자동화, 후원 관리 |\n| 접근성 | Default/Senior UI 자동 추천 (나이, 폰트 스케일 기반) | 리스트·테이블 중심, 필터링·CSV 다운로드 |\n| 스케줄러 | POI/클러스터 기반 자동 루트 생성, ETA, 우선순위 점수 | 중앙 정책 가중치 수정, 이벤트 강제 삽입 |\n| 증빙 | 사진/영수증 업로드, GPS/시간 자동 태깅 | 증빙 승인/반려, 사유 기록 및 감사로그 |\n| 크레딧 | 공천금·후원금 연동 표기, 활동 환급 | 월말 정산/환급 집행, CSV 출력 |\n| 챗봇 | 선거법/체크리스트 질의응답, 웹 연계 | 문서/사례 등록, FAQ 관리 |\n| 권한 | 출마자 단일 계정 (필요시 사무관 공유) | 중앙 관리자(풀뷰), Viewer(옵션) |\n\n### 2.3 데이터 플로우\n\n```mermaid\nflowchart TB\n  subgraph MobileApp[Mobile App (React Native)]\n    A1[Onboarding] --> A2[Schedule Today]\n    A2 --> A3[Task Start/Complete]\n    A3 --> A4[Proof Upload]\n    A2 --> A5[Chatbot Ask]\n  end\n\n  subgraph API[FastAPI Backend]\n    B1[Auth/JWT]\n    B2[Scheduler Engine]\n    B3[Chatbot Engine]\n    B4[Credit Ledger]\n    B5[File Upload]\n  end\n\n  subgraph DB[(PostgreSQL + PostGIS)]\n    C1[Users/Profiles]\n    C2[Tasks/Routes]\n    C3[Proofs]\n    C4[POIs/Clusters]\n    C5[Credits/Donations]\n    C6[Docs/Broadcasts]\n  end\n\n  subgraph Web[Web (Next.js + Java/Python)]\n    D1[Dashboard]\n    D2[Docs Review]\n    D3[Ad Generator]\n    D4[Broadcasts]\n    D5[Donations]\n  end\n\n  A1 --> B1\n  A2 --> B2\n  A5 --> B3\n  A4 --> B5\n  B1 --> C1\n  B2 --> C2\n  B5 --> C3\n  B3 --> C6\n  B4 --> C5\n  D1 --> C2\n  D2 --> C6\n  D3 --> C6\n  D4 --> C6\n  D5 --> C5\n\n```\n\n### 2.4 스케줄러 로직\n\n- **입력 데이터**\n    - 인구·유동 시그널 (교통, 시간대별 혼잡도)\n    - POI 메타데이터 (타입, 접근성, 체류 가능성)\n    - 이벤트 (졸업식, 장터, 단체 회의)\n    - 후보자 선호도 (종교/이동수단/강도)\n    - 과거 성과 (접촉 수, 반응률)\n    - GIS 거리 및 이동시간\n- **우선순위 점수 산식 (예시)**\n    \n    ```markdown\n    score = (α*시간대 + β*타깃군매칭 + γ*접근성 + δ*지역다변화 + ε*과거성과 + ζ*중앙가중치)\n    \n    ```\n    \n- **운영 규칙**\n    - 예비후보자 모드 → 시설/단체 비중 ↑\n    - 후보자 모드 → 거점 인사(출퇴근, 상권) ↑\n    - 1일 과업 수 N, 체류·이동 제한 포함\n\n### 2.5 챗봇 구조\n\n- **엔진**: 룰베이스 + Q&A DB (선거법/서류/공보물 사례)\n- **앱 UX**:\n    - 질문 입력 → 답변 + 근거 스니펫\n    - [자세히 보기] → 웹 리다이렉트\n- **확장**:\n    - 중앙 관리자가 FAQ/사례 추가 가능\n    - 답변 로깅 → 추후 모델 학습 데이터\n\n### 2.6 크레딧 구조\n\n- **개념**: 결제 아님, 표기용 회계\n- **흐름**\n    - 공천금/후원금 유입 → 크레딧 가산\n    - 제휴 구매/지출 → 크레딧 차감\n    - 증빙 미승인 → pending 처리\n    - 월말 정산 → 대시보드/CSV 반영\n- **환급 정책**\n    - 랭킹 기반 보상 (예: 상위 10% 환급)\n    - 중앙당 Rule Engine 관리\n\n### 2.7 보안 및 정책\n\n- **인증/인가**\n    - 휴대폰 본인 인증\n    - JWT + RBAC (candidate, admin, viewer)\n- **데이터**\n    - PII 최소 수집, AES-256 암호화\n    - 전송 시 TLS 적용\n    - 선거 종료 +30일 자동 파기\n- **증빙**\n    - GPS/시간 메타 포함\n    - 파일 해시 저장, 변조 방지\n- **운영**\n    - 장애 시 fallback 모드 → 단순 체크리스트\n\n## 3. 인프라/배포/품질 (Infra / Deployment / Quality)\n\n### 3.1 백엔드/데이터 (권장 우선순위)\n\n- **Supabase(권장 기본)**: PostgreSQL + Auth + Storage + Realtime\n    - RN/Next 공용 SDK: `@supabase/supabase-js`\n    - *RLS(행 수준 보안)**로 선언적 접근제어 → 후보/관리자 권한 모델 구현 용이\n    - 파일(증빙/사진) 업로드: Storage + 서명 URL(만료)\n- **(선택) FastAPI**: 서버 전용 로직/비밀키/웹훅/배치\n    - 예: 스케줄러 점수산식(POI/클러스터), 결제/정산용 안전 처리, 외부 제휴 API 키 관리\n    - 도입 타이밍: **Supabase만으로 커버 어려운 순간부터 추가**\n\n> 전략: MVP는 Supabase 단독으로 빠르게 → 서버 전용 비밀 로직이 필요해지는 시점에 FastAPI를 병행\n> \n\n### 3.2 앱 빌드·배포 (Expo 중심)\n\n- **Expo + EAS(Build/Update)**\n    - Dev: `expo start` → QR 스캔해서 **실기기** 즉시 실행\n    - **EAS Build**: iOS/Android 테스트 빌드 자동화\n    - **EAS Update(OTA)**: 스토어 심사 없이 JS/에셋 핫픽스 배포(네이티브 변경 시에는 스토어 빌드 필요)\n- **푸시 알림**\n    - 초기: **Expo Notifications**\n    - 확장: OneSignal / Firebase(FCM)로 마이그레이션 가능\n\n### 3.3 웹 (Next.js)\n\n- 배포: **Vercel** (PR마다 Preview 링크 자동)\n- 환경변수: `NEXT_PUBLIC_*` 접두사(클라 노출 OK), 민감 값은 Vercel Secret으로\n\n### 3.4 공통 계약/공유 레이어 (강추)\n\n- **OpenAPI 스키마**로 API 계약 정의 → **TS SDK 생성** 후 **웹/RN 공용** 사용 (`/packages/api-client`)\n- **디자인 토큰**(`/packages/design-tokens`): 색/간격/폰트 토큰을 웹·RN 모두에서 사용\n- **공통 타입/유틸**(`/packages/shared`): Zod 스키마, 날짜/좌표, 포맷터 등\n\n### 3.5 관측/품질/실험\n\n- **에러 모니터링**: Sentry(웹/앱/서버 공통)\n- **로그/분석**: Amplitude/Mixpanel 또는 Supabase Analytics\n- **Feature Flag**: GrowthBook/Unleash (클라·서버 SDK 지원)\n\n## 4. 정책 기획 (Operational Policies)\n\n### 4.1 권한 체계 (RBAC)\n\n| 구분 | 권한 | 액션 |\n| --- | --- | --- |\n| 출마자 (예비/후보자) | candidate | 모바일 앱 전 기능 사용 (스케줄, 챗봇, 증빙 업로드, 대시보드 확인). 웹 접근은 개인 자료 업로드·확인 한정. |\n| 캠프 스태프 (비공식) | candidate 계정 공유 | 공식 권한 없음. 출마자 계정 공유로 입력/업로드를 대신 처리. 보안 리스크 → 경고 안내. |\n| 중앙 관리자 (지도부) | admin | 모든 후보자 활동/서류/증빙 뷰. 공지·전술 푸시, 정책 Rule 변경, 환급 집행. |\n| 읽기 전용 뷰어 (선택) | viewer | 특정 데이터 열람만 가능. 예: 회계 감사 목적. |\n\n### 4.2 운영 정책\n\n- **앱 운영**\n    - 기본: 자동 스케줄러 기반으로 할 일 제공.\n    - Senior 모드: 고연령층을 위한 큰 글씨/단일 카드 뷰.\n    - 증빙 업로드 필수: 사진/영수증 + GPS/시간 메타.\n    - 챗봇은 룰베이스 Q&A → 법적 책임은 후보자에게 있음.\n- **웹 운영**\n    - 중앙 관리자용: 대시보드, 서류 검토, 공보물 자동화, 후원 정산.\n    - 후보자용: 웹 리다이렉트된 상세 기능(서류 제출, 광고주문 등) 처리.\n- **공지·전술 푸시**\n    - 중앙당에서 특정 지역/후보자 그룹 대상으로 브로드캐스트 가능.\n    - 예: “[중앙 공지] 오늘 17:30 OO역 3번출구 집중 인사 권고”.\n    - 푸시는 기록·철회 가능, 모든 내역 감사 로그 저장.\n\n### 4.3 데이터 정책\n\n- **보관 주기**\n    - 선거 종료 후 +30일: 모든 GPS/증빙/PII 자동 삭제.\n    - 회계/정산 관련 최소 보존 의무는 CSV 내보내기 후 별도 관리.\n- **보안**\n    - PII 최소 수집 원칙.\n    - AES-256 암호화 저장.\n    - HTTPS 전송.\n    - 파일 다운로드/열람 시 로깅(누가/언제/무엇 확인했는지).\n- **데이터 활용**\n    - 과거 성과(접촉 수, 증빙 기록)는 익명화 후 향후 스케줄러 학습에 사용.\n    - 특정 지역 POI 족보(출퇴근/시장/회의 장소)는 공용 DB화.\n\n### 4.4 회계·정산 정책\n\n- **크레딧 구조**\n    - 공천금, 후원금, 선거 지출 → 크레딧 형태로 표기.\n    - 결제는 아님. 실제 결제는 제휴몰/은행 경로.\n    - Pending: 증빙 대기.\n    - Approved: 정산 반영.\n- **환급**\n    - 월말 랭킹 기준 상위 N명에게 일부 크레딧 환급.\n    - Rule Engine에서 정책 버전/시행일 기록 관리.\n- **증빙 심사 기준**\n    - **화이트리스트 제품군**: 선관위 지정 물품 (현수막, 명함, 어깨띠, 홍보차량 등)만 승인.\n    - 증빙 자료: 원본 사진/영수증 + GPS/시간 메타.\n    - 위배 시: 반려 처리 + 경고 푸시.\n\n### 4.5 선거법/컴플라이언스\n\n- **중앙선관위 지침 준수**\n    - 지정 품목 외 물품 구매 → 자동 차단.\n    - 선거 종료 후 데이터 폐기 필수.\n    - 공보물: 가이드라인 내 문구 필터링(민감 발언, 비방 금지).\n    - 챗봇은 과거 Q&A/선관위 사례를 기반으로 제공 → 법적 책임 회피용 디스클레이머 표시.\n- **예비후보자 vs 후보자**\n    - 예비후보자: 시설 방문/유대감 형성 위주.\n    - 후보자 등록 이후: 거점 인사, 출퇴근 상권 집중.\n    - 스케줄러와 카드 비율이 자동 전환됨.\n\n### 4.6 교육·훈련 정책\n\n- **출마자 오리엔테이션**\n    - 앱 설치 및 온보딩 (폰트/종교/이동수단/강도 설정).\n    - 증빙 업로드 방법.\n    - 챗봇 질의 활용법.\n- **캠프 스태프 교육**\n    - 기본 매뉴얼 PDF/영상 제공.\n    - “민폐 없는 선거운동” 가이드 (이기인 총장 제안 반영):\n        - 명함 줄 때 태도/톤\n        - 시간대별 선거운동 적합/부적합 상황\n        - 지역 주민 불편 최소화 규칙\n\n### 4.7 품질·운영 정책\n\n- **Fallback 모드**\n    - 스케줄러 서버 장애 시 → 단순 체크리스트 모드 전환.\n- **관측 지표**\n    - GPS 업로드율\n    - 증빙 승인율\n    - 챗봇 질문 응답률\n    - 푸시 수신/읽음률\n- **중앙 개입**\n    - 관리자 푸시 개입 시 기록 필수.\n    - 당대표/지도부 격려 메시지는 자동화하지 않고, 사람이 직접 발송.\n\n## 5. 로드맵 (고객 공유용 + 내부 실행)\n\n### 5.1 단계별 계획\n\n| 단계 | 기간 | 주요 산출물 | 상세 내용 |\n| --- | --- | --- | --- |\n| 기능 정의 (Spec Lock) | 9월 1주 | v1.0 기획/명세 문서 | 0902 미팅·의견 반영 → 서비스 비전·기능 확정 |\n| 1차 개발 (MVP Core) | 9월 2~3주 | 앱 기본 화면(React Native), 웹 업로드 기능 | Adaptive Scheduler Mock UI, 기본 Proof Upload, Credit 표기 |\n| 내부 테스트 | 9월 4주 | QA 보고서 | 시뮬레이션 계정 테스트, UI/UX 접근성 검증(Default/Senior) |\n| 납품 1차 | 10월 1주 | 앱 + 웹 1차 버전 | 후보자 온보딩, 오늘의 유세, 챗봇 기본 Q&A, 웹 문서 업로드 |\n| 확장 개발 (v1.5) | 10~11월 | 공보물 자동화, 공천 서류 제출, 관리자 푸시 | Adsland API 연동, 서류 이관 자동화, Broadcast 모듈 |\n| 공천 마감 대응 | 11월 | 안정화 패치 | 후보자 등록 전환 로직(예비→후보자), 크레딧/회계 모듈 고도화 |\n| 선거 직전 빌드업 | 12월~2월 | 대시보드 강화, 랭킹, 크레딧 환급 | 활동 랭킹 집계, Top-N 환급 자동 집행, 후보자 사기 진작 기능 |\n| 선거 기간 운영 | 3월~6월 (선거일까지) | 실시간 운영 지원 | 서버 모니터링, 장애 대응, 관리자 푸시, 선거법 업데이트 챗봇 |\n| 종료 +30일 | 7월 | 데이터 정리/파기 보고서 | 모든 후보자 GPS/증빙 삭제, CSV Export 제공, 클로징 보고서 |\n\n### 5.2 고객 공유용 하이라이트\n\n- 📱 **앱 (비서AI)**: 오늘의 유세 자동 스케줄러 + 증빙 업로드 + 챗봇 Q&A\n- 💻 **웹 (캠페인)**: 대시보드 집계 + 서류 검토/제출 + 공보물 발주 + 후원 관리\n- 🎯 **중앙 관리자 기능**: 공지/전술 푸시 + 활동 랭킹 확인 + 환급 집행\n- 🔒 **정책 준수**: 선거 종료 후 30일 데이터 자동 삭제, 선관위 품목 화이트리스트\n\n### 5.3 내부 실행 체크리스트\n\n- [ ]  **데이터 계약 정합성 확인**: Task/Proof/Broadcast/Profiles 키값 일관성\n- [ ]  **스케줄러 알고리즘**: 예비→후보 모드 전환 로직 자동 반영\n- [ ]  **챗봇 지식베이스**: 선관위 Q&A 사례 PDF 크롤링 → 룰베이스 구축\n- [ ]  **크레딧 회계**: “표기용 Ledger” 구현, 실제 결제 경로와 분리\n- [ ]  **공보물 API 연동**: Adsland 등 파트너사 테스트\n- [ ]  **무한 스크롤 UI**: IntersectionObserver 시뮬레이션 구현\n- [ ]  **Fallback 모드**: 스케줄러 장애 시 체크리스트 모드 전환\n- [ ]  **접근성 테스트**: Senior 모드 글자 크기/단일 카드 뷰 검증\n\n### 5.4 리스크 관리\n\n- **시간 압박**: 선거 일정 고정 → 기능 우선순위 명확히\n- **문서화 부족 리스크**: 지금 단계에서 최소 기획/명세 확정 필수\n- **데이터 보안**: PII, GPS → 유출 시 법적 리스크 → 암호화/파기 철저\n- **정책 충돌**: 선관위 규정 변동 시 챗봇·화이트리스트 즉시 업데이트 필요\n- **운영 리스크**: 서버 부하 대비 → Railway/Render + CDN 캐싱 활용\n\n### 5.5 향후 고도화 (Post-MVP)\n\n- 🏷️ **Gamification**: 후보자 랭킹/배지/퀘스트 시스템 확장\n- 📊 **비교 랭킹**: 동일 선거구 타 정당 후보 GPS/활동 대비 랭킹 (이기인 총장 제안)\n- 🧑‍💻 **AI 보조**: 증빙 자동 분류(사진/영수증 OCR), POI 제안 고도화\n- 🗂️ **출마자 교육 패키지**: 온라인 튜토리얼 + 오프라인 교육 모듈\n- 💬 **확장 챗봇**: 선거법 외 → 지역 공약 설계, 공보물 카피 추천\n\n## 6. 추가 보강 (시나리오 · 스케줄러 · 데이터 계약 등)\n\n### 6.1 대표 사용자 시나리오 (앱 중심, 웹 연계)\n\n### A. (예비)후보자 – “오늘의 유세” 실행 루프\n\n1. 앱 접속 → 상단 리본(중앙 공지/가이드) 확인\n2. 상단 미니맵에서 자동 생성된 동선 요약 확인\n    - 예상 접촉 수, 이동 거리, 우선순위 점수 표시\n3. 하단 할 일 카드 (우선 2개 노출 → 스크롤 시 추가):\n    - **유형 A: POI 인사 유세** → [시작] → GPS 트래킹 ON → [완료] 시 사진·메모 → 증빙 업로드\n    - **유형 B: 시설/단체 방문** → [열기] → 일정/안건 모달 → 필요 시 웹 리다이렉트\n    - **유형 C: 공천·출마 서류 준비** → 체크리스트 모달 → [제출하기] → 웹 리다이렉트\n    - **유형 D: 유세 물품 구매** → 제휴몰 웹 리다이렉트 → 결제 후 영수증 업로드\n4. 활동 종료 → 대시보드 탭에서 금일 기록 확인\n    - (접촉 수, 이동 거리, 완료 과업, 사용 크레딧)\n5. (월말) 활동 랭킹 반영 → 상위 일부 후보 크레딧 환급\n\n### B. 후보자 모드 전환 (법정 후보자 등록 이후)\n\n- 스케줄러: 거점 인사(출퇴근·상권) 비중 ↑, 시설/단체 방문 ↓\n- 네비게이션/ETA 가이드 강화\n- 중앙당 전술 공지(예: 특정 출구 집중) → 리본으로 푸시\n\n### C. 챗봇 플로우 (앱 → 웹)\n\n- “선거법 ○○ 가능?” → 룰베이스 Q&A → 유사사례 근거 모달\n- [자세히 보기] → 웹 정책/사례 뷰어 리다이렉트\n- 챗봇 내 체크리스트/서류 링크 → 웹 리다이렉트\n\n### D. 크레딧(표기) 루프\n\n- 온보딩 시 공천금·선거예산을 크레딧으로 표기 (결제 기능 아님, 회계 표기용)\n- 앱/웹 제휴 구매·증빙 업로드 시 차감\n- 후원금 유입 시 크레딧 가산\n- 월말 대시보드 → 수입·지출·증빙대기 집계\n\n### E. 중앙당 관리자 시나리오 (웹)\n\n- 후보자 리스트/개별 상세: 활동, 증빙, 서류, 후원, 경고\n- 공지·전술 푸시 작성 (선거구/타깃별 브로드캐스트)\n- 월간 랭킹 확정 → 상위 N명 크레딧 환급 집행\n\n### 6.2 스케줄러 입력 & 우선순위 규칙\n\n### 입력 데이터\n\n- 인구·유동 시그널 (시간대별)\n- POI 메타 (접근성, 체류 용이성)\n- 이벤트 (졸업식, 장터, 집회 등)\n- 후보자 선호 (종교/이동수단/강도 설정)\n- 과거 성과 (접촉 수, 체류 성과)\n- GIS 기반 거리·이동시간\n\n### 우선순위 산식\n\n```\nScore = (β1 * TimeMatch)\n      + (β2 * TargetCluster)\n      + (β3 * Accessibility)\n      + (β4 * Diversity)\n      + (β5 * PastPerformance)\n      + (β6 * CentralDirective)\n\n```\n\n- TimeMatch: 시간대/출퇴근 피크 적합성\n- TargetCluster: 2030/중도 무당층 가중\n- Accessibility: 분기점, 횡단보도, 체류 안전\n- Diversity: 커버리지, 중복 최소화\n- PastPerformance: 최근 7~14일 성과 회귀\n- CentralDirective: 특정 POI 집중 시 가중치\n\n### 모드별 가중치\n\n- **예비후보자 모드:** 시설·단체, 라포 형성 ↑\n- **후보자 모드:** 거점 인사, 유동 밀집 유세 ↑\n\n### 제약 조건\n\n- 1일 N개(예: 3~6개)\n- 체류 시간 15~30분, 총합 ≤ 일정 강도 값\n- 이동 거리 ≤ 후보자 이동수단별 허용치\n- 법규 위반 가능성 있는 POI 자동 제외\n\n### 6.3 데이터 계약 (FE–BE 공통 키)\n\n| 계약 키 | 값 집합 | 설명 |\n| --- | --- | --- |\n| `Task.tertiary` | defer · proof · nav · open | UI 버튼 라벨 & 동작 매핑 |\n| `Task.type` | poi-visit · facility-visit · doc-check · ad-purchase | 액션 카드 유형 |\n| `Proof.kind` | photo · receipt | 증빙 종류 |\n| `Broadcast.severity` | info · warn · critical | 공지 리본 톤 |\n| `Profile.intensity` | hard · normal · light | 스케줄 강도 |\n| `Profile.religion` | allowAll · exclude · onlyX | 종교 기관 방문 선호 |\n| `Mobility` | car · pickup · trike · bike · walk | 루트 속도/거리 보정 |\n\n### 6.4 화이트리스트 제품군 (중앙선관위 승인 가능 범위)\n\n- 홍보물: 현수막, 어깨띠, 명함, 배너, 유세복 (규격 제한 준수)\n- 장비: 마이크, 휴대용 스피커, LED 보드 (규격 내), 유세차량(구의원은 불가)\n- 소모품: 배터리, 보온장치, 기본 홍보물 패키지\n- 중앙 플랫폼에서 지정된 벤더 API 연계로만 구매 가능 → 불법 품목 자동 필터링\n\n### 6.5 증빙 심사 기준\n\n- **필수 메타**: GPS 좌표 + 촬영시간 (자동 태깅)\n- **파일 요건**: 원본 파일 해시 검증, 편집본 불허\n- **영수증**: 공급자 상호·사업자번호·품목 일치 여부 확인\n- **현장 사진**: 위치 매칭 + 체류 시간 로그 검증\n- **승인 플로우**: 후보자 업로드 → 중앙 관리자 검토 → 승인/반려 (사유 기록)\n\n### 6.6 챗봇 구조\n\n- **Layer 1: 룰베이스 Q&A**\n    - 선거법, 공천 서류, 공보물 규정 등 키워드 기반 매칭\n    - 중앙선관위 질의응답 DB / 내부 가이드라인 학습\n- **Layer 2: 정책 문서 뷰어 연계**\n    - “자세히 보기” → 웹 뷰어로 리다이렉트\n- **Layer 3: 컨텍스트 추천**\n    - 서류 준비 → 체크리스트 모달 호출\n    - 공보물 문의 → 자동 템플릿 API 연결\n- **운영 정책**: AI 임의 생성 금지, 모든 답변은 근거·출처 포함\n\n## 7. 스케줄러 입력/우선순위 (운영 규칙)\n\n### 7.1 입력 데이터 소스\n\n자동 스케줄링을 위해 필요한 데이터와 수집 방식:\n\n- **인구/유동 데이터**\n    - 행정안전부 주민등록 인구 통계 (정주 인구)\n    - SKT/KT/LGU+ 유동인구 API (시간대별 이동 패턴)\n    - 국토부 교통카드·버스/지하철 승하차 API\n    - 지역 행사 캘린더(졸업식·축제 등)\n- **POI 메타데이터**\n    - 카테고리: 지하철, 버스환승, 학원가, 시장, 종교시설, 복지관 등\n    - 접근성: 출구 수, 횡단보도 개수, 체류 공간 유무\n- **후보자 선호도**\n    - 종교 기관 방문 여부 (온보딩 설정)\n    - 이동 수단 (자차/픽업/도보/자전거 등)\n    - 일정 강도(빡셈/보통/느슨)\n- **GIS & 교통**\n    - OSRM/GraphHopper 기반 ETA(예상 소요시간)\n    - 교통 혼잡도, 도보 우선 루트\n- **과거 성과**\n    - 동일 지점에서의 접촉 수 기록\n    - 증빙된 활동량(사진/메모/명함 반응률 등)\n\n### 7.2 우선순위 산식 (예시)\n\n공식(단순화 예시):\n\n```\nScore(poi) = (BaseExposure × TimeWeight × TargetMatch)\n             + PastPerformance × α\n             + Accessibility × β\n             + DiversityBonus × γ\n             + CentralDirective × δ\n\n```\n\n- **BaseExposure**: 지점별 기본 노출값 (예: 지하철 300, 버스환승 200)\n- **TimeWeight**: 출퇴근/점심/주말 가중치 (출퇴근 ×1.4, 점심 ×1.0, 주말 ×1.2 등)\n- **TargetMatch**: 20·30대, 중도 무당층 비율 매칭 점수\n- **PastPerformance**: 최근 7~14일간 동일 POI 실적 (회귀 반영)\n- **Accessibility**: 체류 용이성, 분기 수, 횡단보도 접근\n- **DiversityBonus**: 중복 최소화(새로운 지점일수록 보너스)\n- **CentralDirective**: 중앙당 지정 전술 가중치 (예: 특정 출구 집중)\n\n### 7.3 모드 전환 규칙\n\n- **예비후보자 모드 (2월 예비후보 등록 이전)**\n    - 시설·단체 방문 비중 ↑ (경로당, 주민센터, 회의 참여)\n    - 라포 형성 및 진정성 어필\n- **후보자 모드 (후보 등록 이후)**\n    - 거점 인사 위주 (출근/퇴근/상권 중심)\n    - 유동인구 밀도 기반 최적 루트\n    - ETA 배지, 체류시간 가이드 강화\n\n### 7.4 운영 룰\n\n- 하루 최대 N개 일정 (예: 3~6개)\n- 체류시간 총합 150~180분\n- 이동시간 총합 ≤ X분 (사용자 선호도 반영)\n- 안전/법규 우선:\n    - 통행 방해 구간 제외\n    - 선관위 허용 범위 벗어난 활동 제외\n- 실시간 알림:\n    - 30분 전 ETA 리마인드\n    - “과밀/중복” 발생 시 자동 대체 추천\n\n### 7.5 UI/UX 반영\n\n- 지도뷰 핀에 ETA 뱃지 노출\n- 동선 요약 시 예상 접촉 수, 거리, 점수 총합 표시\n- 카드뷰 클릭 시 “선정 근거” 모달:\n    - 시간대 신호\n    - 타깃군 매칭\n    - 과거 성과\n    - 접근성 지표\n- Senior 모드: 동선 요약 단순화(“3곳 방문, 총 90분, 예상 200명 접촉”)\n\n## 8. 제약·정책 (컴플라이언스/보안/운영)\n\n### 8.1 법·선거 규정 준수\n\n- **중앙선관위 지침 반영**\n    - 예비후보자 시점: 시설 방문, 라포 형성 중심 (거점 인사 제한).\n    - 후보자 등록 이후: 정식 유세 가능, 거점/출퇴근 유세 허용.\n- **허용/금지 활동 자동 필터링**\n    - 후보자 등록 이전: 유세복/어깨띠 착용 금지 → 스케줄러에서 제외.\n    - 지정 품목(마이크, 현수막 등)만 제휴몰에 노출.\n    - 차량·LED 스크린 등은 법적 허용 여부 및 급별 제한을 반영.\n- **공보물 규정**\n    - 구의원: 8p, 구청장 이상: 16p 이상.\n    - 자간/줄간/여백 등 형식 지침 준수 → 공보물 자동 생성기에서 필터링.\n\n### 8.2 증빙·심사 기준\n\n- **증빙 제출 의무**\n    - 모든 지출 항목: 영수증 + 사진 + GPS/시간 메타데이터 필수.\n    - 모든 유세 활동: 활동 사진(셀피+현장) 또는 메모 증빙.\n- **검증 절차**\n    - 파일 해시 생성 → 위변조 방지.\n    - 업로드 시 자동 메타 태깅 (GPS 좌표, 촬영 시각).\n    - 관리자 검토 단계:\n        - 승인 / 반려 / 보완 요청.\n        - 반려 시 사유 기록.\n- **심사 기준**\n    - 선관위 지정 품목 여부.\n    - 활동 맥락 적절성 (시간/위치/상황 불일치 시 반려).\n    - 개인정보 노출 최소화.\n\n### 8.3 화이트리스트 제품군\n\n- **유세차량**\n    - 픽업트럭(랩핑), 자전거/전동킥보드, 리어카TV(비확성).\n- **유세물품**\n    - 어깨띠, 조끼, 현수막, 피켓, 인쇄물.\n- **홍보매체**\n    - 공보물 인쇄(규격 준수), SNS 광고(법정 비용 한도 내).\n- **금지 품목**\n    - 현금/현물 직접 제공, 기부 성격의 물품.\n    - 과도한 출력(LED/앰프) – 구의원급 제한.\n\n### 8.4 보안·접근 정책\n\n- **인증**\n    - 휴대폰 본인인증 + JWT 토큰 기반 로그인.\n- **역할 기반 접근제어 (RBAC)**\n    - 후보자: 자기 데이터만 접근 가능.\n    - 중앙 관리자: 전체 후보 데이터 열람/공지 푸시.\n    - 뷰어: 읽기 전용 권한(옵션).\n- **파일 관리**\n    - S3 호환 스토리지 사용.\n    - presigned URL 발급, 유효기간 만료 후 접근 불가.\n    - 다운로드 로깅.\n\n### 8.5 데이터 거버넌스\n\n- **보관·파기**\n    - 선거 종료 +30일 → 자동 파기.\n    - 예외(법적 보존 필요)는 별도 동의 및 암호화 보관.\n- **로그 기록**\n    - 누가/언제/무엇을 열람·수정했는지 저장.\n- **암호화**\n    - 개인정보 필드 단위 암호화(AES-256).\n    - 전송 구간 TLS 1.3 이상.\n\n### 8.6 운영·품질 정책\n\n- **장애 대응**\n    - 스케줄러 불가 시 → 단순 체크리스트 모드로 폴백.\n- **UI 접근성**\n    - 나이·폰트 설정 기반 Default/Senior 모드 자동 추천.\n- **푸시/공지**\n    - 모든 공지/전술 푸시는 철회 및 변경 로그를 남김.\n    - 감사 추적 가능.\n- **랭킹/크레딧**\n    - 월말 환급 규칙은 서버 정책으로만 관리.\n    - 버전/시행일 기록 유지.\n\n## 9. 프런트–백엔드 데이터 계약 (핵심 키)\n\n프론트엔드(앱·웹)와 백엔드(FastAPI/Java 서비스)가 동일한 언어로 통신할 수 있도록 **키와 값의 스펙**을 통일한다.\n\n→ UI 버튼·카드와 API 응답 JSON이 1:1 매핑되어야 함.\n\n### 9.1 Task 관련\n\n- **Task.type**\n    - `\"poi-visit\"` : POI 거점 인사 유세\n    - `\"facility-visit\"` : 시설/단체 방문\n    - `\"doc-check\"` : 공천·출마 서류 검토\n    - `\"ad-purchase\"` : 유세 물품/광고 구매\n        \n        → UI 카드의 아이콘/모달 종류 분기\n        \n- **Task.tertiary**\n    - `\"defer\"` : 미루기 버튼\n    - `\"proof\"` : 증빙 업로드 버튼\n    - `\"nav\"` : 네비게이션 버튼\n    - `\"open\"` : 모달/웹 열기 버튼\n        \n        → UI의 3번째 버튼 라벨·동작과 1:1 매핑\n        \n- **Task.status**\n    - `\"planned\"` : 예정\n    - `\"started\"` : 진행 중\n    - `\"done\"` : 완료\n    - `\"failed\"` : 실패/취소\n\n### 9.2 Proof (증빙)\n\n- **Proof.kind**\n    - `\"photo\"` : 현장 사진\n    - `\"receipt\"` : 지출 영수증\n- **Proof.meta**\n    - `gps`: 위도·경도\n    - `taken_at`: 촬영 시각\n    - `hash`: 파일 무결성 해시값\n- **Proof.review**\n    - `verified_by_admin`: boolean\n    - `review_status`: 승인/반려/보완\n    - `reason`: 반려 사유 텍스트\n\n### 9.3 Broadcast / 공지\n\n- **Broadcast.severity**\n    - `\"info\"` : 단순 알림 (파란색 리본)\n    - `\"warn\"` : 주의 권고 (노란색 리본)\n    - `\"critical\"` : 긴급 지시 (빨간색 리본)\n- **Broadcast.payload**\n    - `title`: 공지 제목\n    - `html`: 본문 (리치텍스트/링크 포함)\n\n### 9.4 Profile (유저 설정)\n\n- **Profile.intensity** (일정 강도)\n    - `\"hard\"` : 하루 풀 스케줄 (08:00~22:00)\n    - `\"normal\"` : 보통 밀도\n    - `\"light\"` : 여유 모드 (선택적 일정만)\n- **Profile.religion_pref** (종교 선호도)\n    - `\"none\"` : 구분 없음\n    - `\"exclude:[X]\"` : 특정 종교 기관 제외\n    - `\"only:[Y]\"` : 특정 종교 기관만 포함\n- **Profile.mobility** (이동수단)\n    - `\"car\"`, `\"pickup\"`, `\"trike\"`, `\"bike\"`, `\"walk\"`\n    - 스케줄러가 이동 속도/거리 산출 시 반영\n- **Profile.font_scale**\n    - `\"default\"` : 기본 UI\n    - `\"large\"` : Senior 모드 (큰 글씨·단일 카드)\n\n### 9.5 Credit / 재정\n\n- **Credit.kind**\n    - `\"in\"` : 후원/보조금 유입\n    - `\"out\"` : 유세 비용 지출\n    - `\"hold\"` : 증빙 대기\n- **Credit.meta**\n    - `amount`: 숫자\n    - `ref`: 참조 Task/Proof\n    - `memo`: 간단 메모\n\n### 9.6 문서 / 서류\n\n- **Document.kind**\n    - `\"nomination\"` : 공천 서류\n    - `\"nec_form\"` : 선관위 지정 양식\n- **Document.status**\n    - `\"draft\"` : 작성 중\n    - `\"submitted\"` : 후보 제출 완료\n    - `\"reviewed\"` : 관리자 검토 완료\n    - `\"transferred\"` : 선관위 이관 완료\n\n### ⚡ 요약\n\n- 모든 핵심 키는 **UI ↔ API ↔ DB**를 동일하게 유지.\n- 예: `Task.tertiary = \"proof\"` → 앱 카드에서 “증빙 업로드” 버튼 활성화 → `/tasks/:id/complete` 호출 시 Proof.kind=receipt/photo와 연결.\n\n## 10. 향후 과제 (Next Steps & Memo)\n\n본 문서는 v2.1 수준의 풀패키지 기획/명세를 다루었으며, **MVP → 확장** 단계로 나아가기 위해 다음 과제들을 고려한다.\n\n### 10.1 프론트엔드 (앱/UI/UX)\n\n- **IntersectionObserver 기반 무한 스크롤**\n    - 후보자 앱의 할 일(TaskCard) 목록에 적용 → 초기에는 2개만 노출, 스크롤 시 점진적 로딩.\n    - 목데이터 기반 구현 가능, 이후 백엔드 API pagination 연동.\n- **A/B 테스트 플래그 시스템**\n    - ETA 배지, 동선 요약 시트, 근거 시트 노출 방식 등을 플래그 기반으로 제어.\n    - 중앙 관리자(Admin) 대시보드에서 플래그 On/Off 가능하도록 확장.\n- **접근성 고도화**\n    - Senior 모드 외에 컬러 블라인드 모드, 음성 안내 등 옵션 추가 검토.\n- **리팩토링 & 컴포넌트화**\n    - Button, TaskCard, FooterNav 등은 `/components/` 폴더로 분리, 재사용성 확보.\n\n### 10.2 백엔드 (FastAPI/Java)\n\n- **POI 데이터 소스 통합**\n    - 공공 API (예: 행정안전부 생활인구, 교통공사 승하차 인원) + 내부 입력(족보 DB) + 크롤링 데이터.\n    - 갱신 주기: 1일/1주 단위 → ETL 파이프라인 설계 필요.\n- **스케줄러 최적화 알고리즘**\n    - OR-Tools/GraphHopper/OSRM 중 선택.\n    - 체류 시간·거리 비용 최소화 + 접촉 수 최대화 → Mixed Integer Programming 기반.\n- **공보물 자동 생성**\n    - 템플릿 버전 관리 (ex. v1.0 ~ vN), 폰트/색상/카피 규정 준수.\n    - Adsland, 외부 벤더 API 매핑.\n- **후원/정산 자동화**\n    - Task/Proof/Donation ↔ Credit Ledger 자동 연동.\n    - 월말/분기 단위 환급 내역 CSV 생성, 선관위 제출 형식까지 자동 변환.\n\n### 10.3 데이터 & 거버넌스\n\n- **POI/Cluster 갱신 파이프라인**\n    - 신규 후보자/관리자 입력 → 자동 반영.\n    - 관리자는 우선순위 점수(β값) 조정 가능.\n- **공보물 템플릿 & 가이드라인 자동 검증**\n    - 민감 단어 필터링 (비방, 금지어).\n    - 이미지/사진 DPI/색상 대비 규정 체크.\n- **데이터 보관/파기 정책**\n    - 선거 종료 +30일 후 자동 파기.\n    - 단, 선관위 감사/법적 요구 시 별도 보관(서면 동의).\n- **로그/감사체계**\n    - “누가, 언제, 무엇을 열람/수정했는지” 추적.\n    - 법적 분쟁 대비 이력 유지.\n\n### 10.4 운영/교육\n\n- **출마자 교육 콘텐츠화**\n    - 앱 튜토리얼: “오늘의 유세” 카드 → Proof 업로드 → 대시보드 확인.\n    - 선거법 챗봇 + 실사례 → 교육 모드 제공.\n- **톤앤매너 교육 가이드**\n    - 명함 전달법, 피켓 규정, 유세 음악/볼륨 규칙 등 중앙당이 체크리스트화.\n- **중앙 관리자 교육**\n    - 대시보드에서 공지 작성, 랭킹 확인, 환급 집행 → 워크플로우 매뉴얼 제공.\n\n### 10.5 기술 인프라\n\n- **멀티테넌시 고려**\n    - 향후 개혁신당 외 타 정당/조직에도 SaaS 확장 가능성.\n- **Observability (관측성)**\n    - GPS 업로드율, 스케줄러 지연, 랭킹 산출 시간, 문서 승인 TAT 등 주요 지표 모니터링.\n- **Fail-safe**\n    - 지도/스케줄러 장애 시 “체크리스트 모드”로 폴백.\n- **CI/CD & 버전 관리**\n    - GitHub Actions / Railway 배포 자동화.\n    - 정책 변경(예: 환급 규칙) → 서버 버전 태깅 & ChangeLog 기록.\n\n### ⚡ **핵심 메모**\n\n- MVP 단계는 **앱 기본 루프(스케줄러/Proof/대시보드/챗봇) + 웹 최소한(서류/공지/랭킹)**에 집중.\n- 이후 확장 과제들은 2025년 11월 공천 시점 전까지 **우선순위별로 단계적 적용** 필요.\n\n## 11. 통합 로드맵 (Integrated Roadmap)\n\n- 선거 일정(법정 데드라인)을 기준으로 **MVP → 확장 → 납품/운영** 단계별 통합 로드맵을 설계한다.\n- 목표: **2025년 지방선거(6월) 대비, 2024년 11월 공천 확정 전까지 MVP 안정화**\n\n### 11.1 단계별 로드맵\n\nPhase 0. 사전 준비 (2025.08 ~ 2025.09)\n\n- 기술 인프라\n    - Monorepo 세팅 (/apps, /packages 구조)\n    - React Native(Expo), Next.js, FastAPI, PostgreSQL 초기 세팅\n    - CI/CD 파이프라인 (GitHub Actions, Railway/Render 배포)\n- 데이터/정책\n    - 선거법 자료 수집, 룰베이스 챗봇 초기 학습\n    - POI 소스(공공 데이터, 내부 DB) 정리\n    - 공보물 템플릿 v0.1 제작\n- 산출물: Dev 환경 준비, 기본 DB 스키마, UI Mock (Default/Senior)\n\nPhase 1. MVP 기능 구현 (2025.09 ~ 2025.10)\n\n- 모바일 앱\n    - 오늘의 유세(지도+카드뷰), Proof 업로드, 대시보드, 챗봇 연결\n    - Default/Senior 모드 인터페이스\n- 웹\n    - 후보자 활동 대시보드\n    - 문서 체크리스트/업로드\n    - 중앙 관리자 공지 푸시\n- 백엔드\n    - 스케줄러(POI/클러스터 기반)\n    - 크레딧 Ledger 표기 (공천금·후원금 연동)\n    - Proof API (사진/영수증 + GPS/시간 메타)\n- 산출물: **MVP v1.0 (앱+웹)** — 내부 파일럿\n\nPhase 2. 공천 대응 (2025.11 ~ 2026.02)\n\n- 후보자 등록 이전\n    - 시설·단체 중심 유대 형성 루트 추천\n    - 출마자 교육 콘텐츠(앱 튜토리얼, 챗봇 가이드)\n    - 공보물 카피/디자인 자동화 1차 배포\n- 후보자 등록 이후 (2월~)\n    - 거점 인사 중심 루트 전환\n    - 중앙당 집중 공지/전술 푸시 반영\n    - 크레딧 환급 정책(Beta) 실행\n- 산출물: **v1.5 (공천 특화 기능)**\n\nPhase 3. 지방선거 준비 (2026.03 ~ 2026.05)\n\n- 확장 기능\n    - 랭킹/리워드 시스템 고도화\n    - 무한 스크롤·A/B 테스트 플래그 적용\n    - 공보물 발주 API 연동(Adsland 등)\n    - 후원금 정산 CSV/선관위 양식 자동 변환\n- 운영 강화\n    - 관측성: GPS 업로드율, 랭킹 산출 지연 등 실시간 모니터링\n    - Fail-safe 모드 (체크리스트 모드)\n    - 멀티테넌시 PoC\n- 산출물: **v2.0 (선거 캠프 운영 버전)**\n\nPhase 4. 선거 본선 운영 (2026.06)\n\n- 중앙당 관리자\n    - Top-down 공지/전술 푸시 실시간 반영\n    - 후보자 활동 랭킹 집계 및 격려/환급 실행\n- 출마자\n    - 앱 기반 유세 실행 → Proof 업로드 → 대시보드 확인 루프\n    - 챗봇 선거법 Q&A + Web 상세 자료 확인\n- 산출물: **v2.5 (운영판)** — 선거기간 집중 운영\n\nPhase 5. 사후/회고 (2026.07 ~)\n\n- 데이터 파기 (선거 종료 +30일)\n- 보고서 산출 (성과 분석, 후보자 피드백)\n- SaaS 확장 검토 (타 정당/조직용)\n- 산출물: 사후 보고서, v3.0 SaaS 계획안\n\n### 11.2 주요 마일스톤\n\n| 날짜 | 마일스톤 | 산출물 |\n| --- | --- | --- |\n| 2025.09 | Dev 환경 세팅 완료 | Monorepo 구조, UI Mock |\n| 2025.10 | MVP v1.0 내부 파일럿 | 앱/웹 베타 |\n| 2025.11 | 공천 특화 기능 v1.5 | 시설 방문 중심 루트, 공보물 자동화 |\n| 2026.02 | 후보자 등록 모드 전환 | 거점 인사 중심 루트 |\n| 2026.04 | 확장 기능 v2.0 | 랭킹/리워드, 공보물 API, 후원 정산 |\n| 2026.06 | 본선 운영 v2.5 | 실시간 공지, 증빙 관리, 운영판 |\n| 2026.07 | 사후 회고 & 데이터 파기 | 성과 보고서, v3.0 SaaS 초안 |\n\n### ⚡ **정리**\n\n- 11월 공천 전: 필수 MVP 안정화 → 후보자 등록 이후 모드 전환 대응\n- 2026년 6월: **본선 운영판(v2.5)** 완성 필수\n- 이후: **SaaS 확장/다른 정당에도 제공 가능**한 수준까지\n\n# reform-campaign-spec-v2.3\n\n# 📑 개혁신당 캠페인 매니저 – 패키지 기획/명세 문서 (v2.3 · Full Draft)\n\n---\n\n이전버전(v2.2꼼꼼+추가사항): \n\n[reform_campaign_spec_v2.2](https://www.notion.so/reform_campaign_spec_v2-2-26676daa46b4806e972ad73181c05064?pvs=21)\n\n[패키지 기획명세 추가 사항](https://www.notion.so/26776daa46b4803ea0e5cc0d6e93a884?pvs=21)\n\n---\n\n## 목차\n\n1. 서비스 기획 (Product Vision & Scope)\n2. 개발 기능 명세 (Feature & Tech Spec)\n3. 인프라/배포/품질 (Infra / Deployment / Quality)\n4. 정책 기획 (Operational Policies)\n5. 사용자 시나리오 (User Scenarios)\n6. 데이터 플로우 (Data Flow)\n7. API 스펙 (API Specification)\n8. 데이터 계약 (Data Contracts)\n9. 스케줄러 / POI 산식 (Scheduler & POI)\n10. 챗봇 구조 (Chatbot Architecture)\n11. 화이트리스트 & 증빙 정책 (Whitelist & Proof Policy)\n12. 교육/톤앤매너 정책 (Training & Tone of Manner)\n13. 로드맵 & 운영 지표 (Roadmap & Metrics)\n14. 향후 과제 (Future Work)\n\n---\n\n## 1. 서비스 기획 (Product Vision & Scope)\n\n### 1.1 배경\n\n- 정치 캠페인 현장은 즉시성·모바일 중심.\n- 선거철 실무자는 PC 사용 시간 ↓, 현장 인사·유세 활동 ↑.\n- 고객(개혁신당)의 요구: “모바일 앱 + 웹” 플랫폼 지정.\n\n### 1.2 목표\n\n- **모바일 앱 (가칭: 비서AI, React Native + Python BE)**\n오늘의 퀘스트, 액션 기록, 챗봇 기반 가이드 → 현장 즉시성.\n- **웹 (가칭: 개혁신당 캠페인, Next.js FE + Java/Python BE + Postgre DB)**\n자료 관리, 대시보드 집계, 공천/공보물 서류 처리 → 행정/분석.\n\n### 1.3 유저 타입\n\n- **타입 1: 출마자(예비·후보자)**\n원칙적으로 1계정/1캠프, 필요시 사무관에게 계정 공유 가능.\n- **타입 2: 중앙당 관리자**\n출마자 활동을 집계해 모니터링, 공지·전술 푸시 가능.\n\n### 1.4 사용자 페르소나\n\n- **2030 (예비)후보자**: 모바일 친숙, 빠른 입력, 즉시성.\n- **4050 (예비)후보자**: 일정·자료 검토 중심, 증빙 확실.\n- **60+ (예비)후보자**: 단순·큰 글씨 UI 필요 (Senior 모드).\n- **중앙당 관리자**: 전체 뷰, 정책/전술 조정, 리포팅 관리.\n\n---\n\n## 2. 개발 기능 명세 (Feature & Tech Spec)\n### 2.1 플랫폼별 기능\n\n| 구분 | 모바일 앱(비서AI) | 웹(개혁신당 캠페인) |\n| --- | --- | --- |\n| 핵심 | 오늘의 유세(지도+카드), 자동 스케줄, 활동 기록, 챗봇 | 후보 관리, 공지 푸시, 대시보드, 서류 검토, 공보물 발주, 후원·정산 |\n| 접근성 | Default/Senior UI (큰 글씨, 단일 카드) | 리스트/테이블, 필터/다운로드 |\n| 증빙 | 사진/영수증 업로드, GPS/시간 메타 | 검토·승인·반려, 기록 저장 |\n| 크레딧 | 표기용 회계: 후원/공천금 ↔︎ 사용내역 | 월말 정산, 환급 집행 |\n| 챗봇 | 선거법/체크리스트 Q&A → 모달 → 웹 이동 | 정책문서 관리, FAQ 확장 |\n| 권한 | 출마자 1계정(공유 가능) | 중앙 관리자(전체 가시성), Viewer(선택) |\n\n### 2.2 데이터 모델 (요약)\n\n#### 웹(개혁신당 캠페인) 주요 데이터 모델\n- `users`, `profiles`, `roles` : 관리자, 후보자 정보 및 권한 관리\n- `tasks`, `routes`, `proofs` : 후보자별 과업 관리, 증빙(사진/영수증) 연동\n- `credit_ledgers`, `donations` : 후원금/지출 내역 관리, 정산/환급 모듈\n- `documents`, `broadcasts` : 공천 서류 및 공지 푸시 관리\n- `pois`, `signals` : POI, 유동인구 등 스케줄러 데이터(조회/분석)\n\n> 웹에서는 후보자 관리, 증빙 심사, 정산, 공지 작성 및 집계 대시보드 중심으로 데이터가 활용됩니다.\n\n- `pois`, `signals` : POI, 유동인구 등 스케줄러 데이터(조회/분석)\n\n> 웹에서는 후보자 관리, 증빙 심사, 정산, 공지 작성 및 집계 대시보드 중심으로 데이터가 활용됩니다.\n\n### 2.3 스케줄러 입력\n\n- 시간대별 유동 인구 시그널\n- POI 메타(진입/체류 용이성)\n- 이벤트(졸업식, 장날)\n- 후보 선호(종교/모빌리티/강도)\n- 과거 성과(접촉 수)\n\n---\n\n## 3. 인프라/배포/품질 (Infra / Deployment / Quality)\n\n### A. 백엔드/데이터\n\n- **Supabase(권장)**: Postgres + Auth + Storage + Realtime\n- **FastAPI(선택)**: 서버 전용 로직/웹훅/배치\n\n### B. 앱 빌드·배포\n\n- **Expo + EAS**: Dev(QR 실행), Build, OTA Update.\n- Next.js 기반 웹 프론트엔드 구현\n- Vercel Preview/Prod 배포 파이프라인 구성\n- 환경변수: `NEXT_PUBLIC_*` 접두사 사용 (클라이언트 노출 허용)\n\n- Vercel Preview/Prod 배포 파이프라인 구성\n- 환경변수: `NEXT_PUBLIC_*` 접두사 사용 (클라이언트 노출 허용)\n\n### D. 공통 계약\n\n- **OpenAPI 스키마**로 정의.\n- TS SDK 생성 → RN/Next 공용.\n- 디자인 토큰/문구 패키지화.\n\n### E. 관측/품질\n\n- Sentry(에러 모니터링).\n- Amplitude/Mixpanel.\n- Feature Flag: GrowthBook/Unleash.\n\n---\n\n## 4. 정책 기획 (Operational Policies)\n\n### 4.1 권한 체계\n- 후보자(출마자): 본인 계정, 사무관과 공유 가능. 대시보드에서 개인 활동, 증빙, 서류 제출, 공지/팔로업 등 개별 인터페이스 제공\n- 중앙 관리자(당 지도부): 전체 후보 현황 뷰, 정당 전체를 대상으로 한 공지·전술 메시지 발송, 공보물 콘텐츠 관리, 증빙 심사 및 정책 집행 등 권한 중심의 관리자 모드 제공\n\n- 웹: 관리자(중앙당 지도부)와 후보자 각각에 맞는 대시보드 및 인터페이스 제공\n    - 관리자: 전체 후보 현황 관리, 정당 단위 공지/전술/캠페인 메시지 발송(Top-down), 공보물 카피/콘텐츠 등록, 증빙 및 서류 심사, 크레딧 환급 등\n    - 후보자: 개인 활동 및 증빙 현황 확인, 서류 제출, 공지/전술 메시지 및 팔로업 액션, 앱 챗봇에서 리다이렉트되어 정책 세부 정보 확인 가능\n- 챗봇: 룰베이스 기반, AI 자동 생성 금지 (참고)\n\n### 4.2 운영 정책\n\n- 챗봇: 룰베이스 기반, AI 자동 생성 금지 (참고)\n- 앱의 챗봇에서 정책/FAQ 클릭 시 웹 상세 정보 확인, 서류 제출 등 팔로업 액션이 자연스럽게 연결되도록 설계\n\n- 챗봇: 룰베이스 기반, AI 자동 생성 금지 (참고)\n- 앱의 챗봇에서 정책/FAQ 클릭 시 웹 상세 정보 확인, 서류 제출 등 팔로업 액션이 자연스럽게 연결되도록 설계\n\n- 앱: 오늘의 유세 중심, 증빙 업로드, 챗봇 Q&A (API, 데이터 연동에 참고)\n- 챗봇: 룰베이스 기반, AI 자동 생성 금지 (참고)\n\n- 챗봇: 룰베이스 기반, AI 자동 생성 금지.\n\n### 4.3 데이터 정책\n\n- 로그/증빙 내부 검토 전용.\n- 선거 종료 +30일 후 삭제.\n- 외부 유출 금지.\n\n---\n\n## 5. 사용자 시나리오 (User Scenarios)\n\n### 5.1 예비후보자 루프\n\n- 앱 접속 → 리본 공지 확인.\n- 미니맵 동선 확인(접촉 수/우선순위).\n- 할 일 카드 실행:\n    - POI 인사: GPS 트래킹 → 증빙 업로드.\n    - 시설 방문: 일정 공지 모달 → 웹 리다이렉트.\n- 후보자 리스트/상세/서류/증빙/후원 내역 통합 관리\n- 공지·전술 푸시 발송 및 이력/철회 관리\n- 월말 랭킹 산출 및 크레딧 환급 실행, 집계 대시보드\n- 감사 로그(접근/수정/다운로드 기록) 및 CSV 내보내기\n- 관리자별 권한 분리(전체/뷰어 등)\n\n\n- 후보 등록 이후 거점 인사 비중 ↑.\n- ETA 배지, 중앙 푸시 공지 반영.\n\n### 5.3 관리자\n\n- 후보자 리스트/상세/서류/증빙/후원 내역 통합 관리\n- 공지·전술 푸시 발송 및 이력/철회 관리\n- 월말 랭킹 산출 및 크레딧 환급 실행, 집계 대시보드\n- 감사 로그(접근/수정/다운로드 기록) 및 CSV 내보내기\n- 관리자별 권한 분리(전체/뷰어 등)\n\n---\n\n## 6. 데이터 플로우 (Data Flow)\n\n앱(RN/Expo) → API(FastAPI/Supabase) → DB(PostgreSQL) → 웹(Next.js/Vercel).\n\n- 인증: SMS → JWT.\n- 증빙: 파일 업로드 + GPS/시간 메타.\n- 챗봇: 룰베이스 → 웹 리다이렉트.\n\n---\n\n## 7. API 스펙 (API Specification)\n\n- `POST /auth/login-sms` {phone} → {token}\n- `GET /schedule/today` → {route, tasks[]}\n- `POST /tasks/:id/start`\n- `POST /tasks/:id/complete` {proofId?}\n- `POST /proofs` (multipart) → {url, gps, time}\n- `POST /chat/ask` {text} → {answer, refs, goto}\n- `GET /credit/summary` → {balance, pendingCount}\n- `GET /broadcasts/today` → {items[]}\n- `GET /docs/checklist` → {items[]}\n\n---\n\n## 8. 데이터 계약 (Data Contracts)\n\n- **Task.tertiary** ∈ {`defer`,`proof`,`nav`,`open`}\n- **Task.type** ∈ {`poi-visit`,`facility-visit`,`doc-check`,`ad-purchase`}\n- **Proof.kind** ∈ {`photo`,`receipt`}\n- **Broadcast.severity** ∈ {`info`,`warn`,`critical`}\n- **Profile.intensity** ∈ {`hard`,`normal`,`light`}\n- **Mobility** ∈ {`car`,`pickup`,`trike`,`bike`,`walk`}\n\n---\n\n## 9. 스케줄러 / POI 산식\n\n- **시간대 가중치**: 출퇴근 ×1.4, 주말 ×1.2, 야간 ×1.1.\n- **노출 기준값**: 철도 300, 버스환승 200, 시장 150.\n- **우선순위 규칙**: 출퇴근 상향, 등하교 하향.\n- **공식**: exposure = base × time_weight + priority.\n- **최적화 목표**: Σ(exposure) 최대화 – (이동/대기 비용).\n\n---\n\n## 10. 챗봇 구조\n\n- **룰베이스**: 선거법 Q&A, 체크리스트.\n- **소스**: 중앙선관위 FAQ, 과거 사례, 내부 DB.\n- **모달 UX**: 근거 스니펫 → [자세히 보기] 웹 리다이렉트.\n- **모드별**:\n    - 예비후보자: 서류/규제 안내 비중 ↑.\n    - 후보자: 현장 규칙/증빙 안내 ↑.\n\n---\n\n## 11. 화이트리스트 & 증빙 정책\n\n- **화이트리스트 제품군**: 현수막, 명함, 어깨띠, 마이크, 차량 랩핑 등.\n- **증빙 요건**: 사진/영수증 + GPS/시간 메타 필수.\n- **심사 기준**: 중앙 관리자 승인/반려 기록.\n\n---\n\n## 12. 교육/톤앤매너 정책\n\n- **출마자 교육**: 오프라인 필수(명함 배부, 톤/제스처).\n### 13.2 운영 지표 (웹 중심)\n\n- 증빙 심사 처리율 및 승인 TAT(Turn Around Time)\n- 공지/전술 푸시 수신 및 열람률\n- 크레딧 집계/정산 정확도, 환급 집행 내역\n- 후보자별 서류 제출/승인 현황\n- 접속/다운로드/접근 로그(감사)\n\n### 13.1 로드맵\n\n- **기능 정의**: 9월 1주 – 명세 확정.\n- **1차 개발**: 9월 2~3주 – 앱 기본 화면, 웹 서류 업로드.\n- **테스트**: 9월 4주 – 내부 피드백 반영.\n### 13.2 운영 지표 (웹 중심)\n\n- 증빙 심사 처리율 및 승인 TAT(Turn Around Time)\n- 공지/전술 푸시 수신 및 열람률\n- 크레딧 집계/정산 정확도, 환급 집행 내역\n- 후보자별 서류 제출/승인 현황\n- 접속/다운로드/접근 로그(감사)\n\n- 크레딧 집계 정확도.\n\n---\n\n## 14. 향후 과제\n\n- IntersectionObserver 기반 무한 스크롤.\n- A/B 테스트 플래그 (ETA 배지 노출 방식).\n- POI 데이터 소스 통합 (공공 API + 수기 족보).\n- 공보물 템플릿 버전관리, 벤더 연동.\n- 선거법 챗봇 사례 업데이트 파이프라인.\n\n---",
      "writedAt": "2025-09-07T19:12:15.165Z"
    },
    {
      "type": "architecture",
      "content": "# Technical Requirements Document (TRD)\n\n## 1. Executive Technical Summary\n- 프로젝트 개요\n  - 단일 데이터 계층(PostgreSQL + PostGIS)을 중심으로 모바일 앱(React Native/Expo)과 웹(Next.js)이 공용 API(주: Spring Boot, 보조: FastAPI)를 통해 작동하는 최소 구현 아키텍처를 채택한다.\n  - Spring Boot는 외부 공개 API 게이트웨이이자 인증/인가, RBAC, 파일 업로드, 브로드캐스트 푸시, 증빙/정산/문서 관리의 주 엔드포인트를 제공한다.\n  - FastAPI는 스케줄러/챗봇 내 비즈니스 로직을 담당하는 내부 서비스로 동작하며, Spring Boot와 내부 REST로만 통신한다(외부 비공개). 두 서비스는 동일 PostgreSQL과 S3 호환 스토리지를 공유한다.\n- 코어 기술 스택\n  - 프런트엔드: React Native(Expo), Next.js(TypeScript)\n  - 백엔드: Spring Boot(Java, 주 API), FastAPI(Python, 스케줄러/챗봇)\n  - 데이터: PostgreSQL(+PostGIS), S3 호환 스토리지\n  - 인증/알림: JWT(RBAC), Naver Cloud SENS(SMS), Expo Push\n- 핵심 기술 목표\n  - 성능: Today 스케줄 API p95 < 300ms(캐시 제외), 증빙 업로드 완료 < 2s(네트워크 제외), 관리자 대시보드 주요 쿼리 p95 < 500ms\n  - 확장성: 단일 DB 스키마 유지로 초기 비용 최소화, 서비스 분리는 내부 REST로만(필요시 단계적 분리)\n  - 신뢰성: 파일 무결성 해시, GPS/시간 메타 자동 태깅, 선거 종료+30일 자동 파기 잡(Scheduler)\n- 주요 기술 가정\n  - 지도/ETA는 초기엔 휴리스틱 기반(포인트 간 단순 ETA/거리)으로 제공하고, OR-Tools/OSRM 등 복잡도는 확장 단계에서 도입\n  - 결제는 미포함(크레딧 표기 전용), 제휴 상점/벤더 연동은 후속 단계\n  - 한국 SMS 인증은 Naver Cloud SENS를 사용, 푸시는 Expo Notifications로 시작\n  - 외부에 공개되는 API는 Spring Boot 단일 엔드포인트만 제공(클라이언트 단순화)\n\n## 2. Tech Stack\n\n| Category | Technology / Library | Reasoning (Why it's chosen for this project) |\n| ----------------- | --------------------------- | -------------------------------------------- |\n| 모바일 플랫폼 | React Native (Expo) | 현장성 높은 앱을 빠르게 개발/배포(OTA)하며 iOS/Android 동시 대응 |\n| 모바일 네비게이션 | React Navigation | 경량, 커뮤니티 성숙, Expo와 궁합 우수 |\n| 지도/지오 | react-native-mapbox-gl, Mapbox SDK | 한국 커버리지/스타일 유연성, RN/Web 공용 전략에 유리 |\n| 상태/데이터 페칭 | React Query + Zustand | 서버 상태/캐시와 로컬 UI 상태를 단순 분리, 학습비용↓ |\n| 폼/유효성 | React Hook Form + Zod | 접근성/성능 우수, 스키마 유효성 공용화 |\n| 웹 프런트엔드 | Next.js (TypeScript) | 서버/클라이언트 렌더 유연, Vercel 배포 간편, SEO/대시보드에 적합 |\n| 웹 UI | Ant Design | 관리자 테이블/필터/폼 생산성, 문서/컴포넌트 성숙 |\n| 백엔드(주 API) | Spring Boot 3 + Spring Security + JWT | 타입 안전/엔터프라이즈 친화, RBAC/감사/스케줄링 안정 |\n| 백엔드(보조) | FastAPI (Python 3.11) | 스케줄러/챗봇 규칙 엔진 구현에 민첩, 데이터 과학 생태계 호환 |\n| 데이터베이스 | PostgreSQL 15 + PostGIS | 단일 소스, 공간쿼리/거리/클러스터 계산, 트랜잭션 일관성 |\n| 마이그레이션 | Flyway (Spring Boot 구동 시) | 단일 마이그레이션 소유자 원칙, 다언어 서비스 간 스키마 일관성 |\n| ORM/DAO (Java) | Spring Data JPA + QueryDSL | 생산성/가독성, 복잡 조회 최적화에 유리 |\n| ORM (Python) | SQLAlchemy 2.0 | 서비스 별도 도메인에 필요한 최소 CRUD 구현 |\n| 스토리지 | AWS S3 호환(예: AWS S3/Cloudflare R2) | 증빙/이미지 저장, presigned URL 통한 보안 다운로드 |\n| 인증/SMS | Naver Cloud SENS (SMS OTP) | 국내 SMS 인증 안정/비용 효율 |\n| 푸시 알림 | Expo Notifications | RN/Expo와 직결, 초기 운영 단순화 |\n| API 스펙/SDK | OpenAPI 3 + openapi-generator | TS SDK 자동생성, FE/BE 계약 일관성 |\n| 오류 모니터링 | Sentry (web/app/api) | 전면적 에러 추적, 배포 연동 |\n| 로그/분석 | Amplitude 또는 Mixpanel | 사용자 행동/퍼널 추적(앱 중심) |\n| CI/CD | GitHub Actions | 빌드/테스트/배포 파이프라인 단순화 |\n| 호스팅/배포 | Vercel(web), Railway/Render(api), EAS(app) | 저비용/신속 배포, 프리뷰 환경 자동 |\n| 캐시(선택) | Redis (Phase 3) | 스케줄 캐시, 레이트 리밋 등 확장 시 도입 |\n\n## 3. System Architecture Design\n\n### Top-Level building blocks\n- 모바일 앱(React Native/Expo)\n  - 서브: Today 스케줄 뷰, TaskCard, Proof 업로드, 챗봇, 대시보드, Senior 모드\n- 웹 프런트엔드(Next.js)\n  - 서브: 관리자 대시보드, 후보자/증빙/서류/크레딧/브로드캐스트 관리\n- 주 API(Spring Boot)\n  - 서브: 인증/SMS OTP, JWT/RBAC, Task/Proof/Credit/Docs/Broadcast 엔드포인트, 파일 업로드, presigned URL, 정기 파기 잡\n- 보조 서비스(FastAPI)\n  - 서브: 스케줄러 엔진, 챗봇 룰베이스 Q&A, 내부 REST 인터페이스\n- 데이터 계층\n  - PostgreSQL(+PostGIS), S3 호환 스토리지\n- 외부 서비스\n  - Naver Cloud SENS(SMS), Expo Push, Mapbox\n\n### Top-Level Component Interaction Diagram\n```mermaid\ngraph TD\n    M[Mobile (React Native)] --> G[Spring Boot API]\n    W[Web (Next.js)] --> G[Spring Boot API]\n    G --> D[(PostgreSQL + PostGIS)]\n    G --> S3[(S3-compatible Storage)]\n    G --> P[FastAPI (Scheduler/Chatbot)]\n    P --> D\n    G --> X[Expo Push]\n    G --> N[SENS (SMS OTP)]\n    M -->|Map tiles| MB[Mapbox]\n    W -->|Admin views| D\n```\n\n- 모바일/웹은 단일 게이트웨이(Spring Boot)로만 통신하여 클라이언트 구성을 단순화한다.\n- Spring Boot는 DB/Storage에 직접 접근하며, 스케줄러/챗봇은 내부 FastAPI로 위임한다.\n- 푸시/문자 인증은 Spring Boot가 외부 서비스(Expo/Naver SENS)를 호출한다.\n- 지도 타일은 모바일이 Mapbox를 직접 호출(키는 앱 안전장치/도메인 제한 적용).\n\n### Code Organization & Convention\n도메인 주도 조직 전략\n- 도메인 분리: users/profiles, tasks/routes, proofs, credits/donations, documents, broadcasts, scheduler, chatbot\n- 레이어 아키텍처: presentation(controllers) / application(services) / domain(entities) / infrastructure(repos, gateways)\n- 기능 단위 모듈화: 후보 관리, 증빙 심사, 브로드캐스트 발송 등 기능별 패키지화\n- 공용 컴포넌트: 타입, 유틸, 디자인 토큰, OpenAPI 기반 SDK를 패키지로 공유\n\n폴더 구조(단순/최소)\n```\n/\n├── apps\n│   ├── mobile/                    # React Native (Expo)\n│   │   ├── app/                   # route/screens\n│   │   ├── components/\n│   │   ├── features/              # task, proof, chat, credit\n│   │   ├── hooks/\n│   │   ├── services/              # api client\n│   │   └── store/\n│   └── web/                       # Next.js (admin portal)\n│       ├── app/                   # /dashboard, /candidates, /proofs ...\n│       ├── components/\n│       ├── features/\n│       └── services/\n├── services\n│   ├── admin-api/                 # Spring Boot\n│   │   ├── src/main/java/.../api  # controllers\n│   │   ├── src/main/java/.../app  # services\n│   │   ├── src/main/java/.../domain\n│   │   ├── src/main/java/.../infra\n│   │   └── src/main/resources/db/migration  # Flyway\n│   └── scheduler/                 # FastAPI\n│       ├── app/                   # routers, services\n│       ├── domain/\n│       └── infra/\n├── packages\n│   ├── api-client/                # OpenAPI TS SDK (generated)\n│   ├── shared/                    # types, zod schemas, utils\n│   └── design-tokens/             # colors, spacing, typography\n├── infra\n│   ├── docker/                    # Dockerfiles, compose for local\n│   └── scripts/                   # db init, seed, backup\n└── docs/                          # OpenAPI, ADR, ERD\n```\n\n### Data Flow & Communication Patterns\n- 클라이언트–서버\n  - REST(JSON) 기반; 모바일/웹 → Spring Boot API(단일 베이스 URL)\n  - 인증: SMS OTP → JWT 발급, 헤더 Authorization: Bearer\n- 데이터베이스 상호작용\n  - Spring Boot: JPA/QueryDSL, HikariCP 풀; Flyway로 마이그레이션 단일 소유\n  - FastAPI: SQLAlchemy 읽기/쓰기(스케줄러/챗봇 테이블 중심), 트랜잭션 최소 원칙\n- 외부 서비스 연동\n  - SMS: SENS REST API(OTP 요청/검증)\n  - Push: Expo Push API(브로드캐스트/경고)\n  - 지도: Mapbox 타일/지오코딩(필요 시)\n- 실시간 통신\n  - 초기 미도입. 긴급 공지는 푸시(Expo)로 전달\n- 데이터 동기화\n  - 단일 PostgreSQL 사용. 서비스 간 이벤트는 DB 변경 기반으로 폴링/쿼리(초기 단순), 확장은 Redis Pub/Sub 고려(후속 단계)\n\n## 4. Performance & Optimization Strategy\n- PostGIS 인덱싱(geometry, GIST)과 핵심 테이블(tasks, proofs, broadcasts)에 조합 인덱스 적용, 대시보드 조회는 필요한 필드만 Select\n- Today 스케줄 API는 시간대/지역 키로 간단 캐시(애플리케이션 메모리) 적용, 후보자 설정 변경 시 캐시 무효화\n- 증빙 업로드는 presigned URL 직업로드(클라이언트→S3), 백엔드는 메타 수신만 처리하여 I/O 병목 제거\n- 페이징/커서 기반 목록 API, 무한 스크롤 연동, N+1 방지(JPA fetch join/Batch size)\n\n## 5. Implementation Roadmap & Milestones\n### Phase 1: Foundation (MVP Implementation)\n- 코어 인프라\n  - Monorepo, DB 스키마 v1(Flyway), S3 버킷, SENS/Expo 키 설정\n- 필수 기능\n  - 모바일: 오늘의 유세(목록/지도), Task 시작/완료, Proof 업로드(photo/receipt), 챗봇 Q&A(룰베이스), 대시보드, Senior 모드\n  - 웹: 후보자 리스트/상세, 증빙 심사(승인/반려/사유), 공지 브로드캐스트 발송, 서류 체크리스트/업로드\n  - 백엔드: JWT/RBAC, OTP 로그인, Proof 메타(GPS/시간/해시), 브로드캐스트 푸시, 문서 저장소\n  - 스케줄러: 휴리스틱 점수(시간대/POI/성과/중앙가중치), 예비↔후보 모드 전환\n- 보안 기본\n  - TLS, JWT 만료/갱신, presigned URL 만료, PII 최소 필드 AES-256 암호화\n- 개발 환경/CI\n  - GitHub Actions(빌드/테스트), Vercel(웹), Railway/Render(API), EAS 빌드/OTA\n- 타임라인\n  - 4~6주\n\n### Phase 2: Feature Enhancement\n- 고급 기능\n  - 크레딧 집계/월말 랭킹/환급 CSV, 관리자 대시보드 지표, 공지 이력/철회/감사 로그\n  - 챗봇 KB 관리 UI(FAQ/사례 등록), 스케줄러 근거 시트(점수 분해)\n- 성능 최적화\n  - 주요 조회 캐시, 대량 리스트 커서 기반, 이미지 썸네일 파이프라인\n- 보안 강화\n  - 관리자 액션 감사로그, 레이트 리밋, 파일 바이러스 스캔(선택)\n- 모니터링\n  - Sentry 전면 도입, Amplitude 이벤트/퍼널 구성\n- 타임라인\n  - 4주\n\n### Phase 3: Scaling & Optimization\n- 확장성\n  - Redis 캐시/레이트 리밋, 스케줄러 백그라운드 잡 큐(선택)\n  - 지도/ETA 고도화(OSRM/GraphHopper PoC), OR-Tools 실험\n- 고급 연동\n  - 공보물/벤더 API 연동(Adsland 등), 후원 정산 CSV/양식 자동화\n- 엔터프라이즈\n  - 멀티 테넌시 키 칼럼 추가(정당/조직 식별자), 권한 세분화\n- 컴플라이언스\n  - 데이터 파기 자동화 점검/보고, 변경 이력(Audit) 확장\n- 타임라인\n  - 6~8주\n\n## 6. Risk Assessment & Mitigation Strategies\n### Technical Risk Analysis\n- 기술 리스크\n  - 이중 언어 백엔드(Java/Python) 복잡도 증가 → 단일 DB/단일 마이그레이션(Flyway) 원칙, 내부 REST만 허용\n- 성능 리스크\n  - PostGIS 공간쿼리 부하 → 적절한 GIST 인덱스/단순화(geometry simplification), 캐시 계층 도입(Phase 2~3)\n- 보안 리스크\n  - PII/GPS/증빙 유출 → AES-256 필드 암호화, presigned 단기 URL, 접근 로그/감사\n- 통합 리스크\n  - 푸시/SMS 외부 장애 → 재시도 큐/지연 재시도, Fallback 모드(체크리스트)\n\n- 완화 전략\n  - 성능 테스트(스케줄/증빙/대시보드) 사전 수행, 인덱스/쿼리 프로파일링\n  - 에러 버짓/알림 룰 설정(Sentry), 장애 핸드북/Runbook 문서화\n\n### Project Delivery Risks\n- 일정 리스크\n  - 선거 일정 고정 → MVP 범위 엄격 관리, Nice-to-have는 Phase 2+로 이관\n- 리소스 리스크\n  - 지도/스케줄러 전문지식 필요 → 휴리스틱 우선, 고급 알고리즘은 PoC 후 단계 반영\n- 품질 리스크\n  - 다기능 동시 개발 → 도메인 단위 기능 완결(작게 나눠 병렬), 계약 우선(OpenAPI 우선)\n- 배포 리스크\n  - 스토어 심사 지연 → EAS OTA 활용, 네이티브 변경 최소화\n- 대응책\n  - 주간 스코프 락/버전 태깅, 기능 플래그로 안전 롤아웃\n  - 사전 테스트 계정/데이터 시드, 스테이징 환경 필수 운영\n\n---\n\n## 3. System Architecture Design (세부)\n\n### Top-Level Component Interaction 설명\n- 모바일/웹은 단일 API(Spring Boot)와 통신하며 인증/인가/데이터 CRUD/파일 링크를 처리한다.\n- 스케줄러/챗봇 로직은 FastAPI에서 수행되고 결과를 Spring Boot가 조합/캐시하여 클라이언트에 응답한다.\n- DB는 모든 서비스의 단일 소스이며, 파일은 S3 호환 스토리지에 저장된다.\n- 공지/경고는 Expo Push로 발송, SMS OTP는 Naver SENS를 사용한다.\n\n### Data Flow & Communication Patterns (요약)\n- 클라이언트 요청 흐름: App/Web → Spring Boot → (DB/S3/Expo/SENS/FastAPI)\n- FastAPI 내부 호출: Spring Boot → FastAPI(/schedule/score, /chat/ask 등) → DB\n- 파일 업로드: App/Web가 presigned URL로 S3에 직접 업로드 → 메타는 Spring Boot에 기록\n- 브로드캐스트: Admin(Web) → Spring Boot → Expo Push → App 배지/리본 표출\n\n--- \n\n## 4. Performance & Optimization Strategy (추가 지침)\n- DB\n  - 핵심 FK/상태/시간 인덱스 설계(tasks(user_id,status,scheduled_at), proofs(user_id,created_at), broadcasts(target_scope,created_at))\n  - 공간 인덱스(pois.geom GIST), 근접 질의는 ST_DWithin + LIMIT\n- API\n  - 목록 API는 커서 기반, 필터 조합 제한(화이트리스트된 필터만), 응답 필드 슬라이싱\n- 앱/웹\n  - 이미지 썸네일/지연 로딩, 무한 스크롤, 배치 업로드 재시도\n- 백그라운드\n  - 증빙 메타 처리(해시/EXIF)는 비동기 처리 큐(간단 스레드 풀)로 사용자 대기 최소화\n\n## 5. Implementation Roadmap & Milestones (상세)\n- Phase 1(4~6주)\n  - 데이터 계약(OpenAPI/ERD) 고정, 인증/권한/RBAC, Proof/Task/Docs/Broadcast/Credit 최소플로우, 스케줄러 휴리스틱 v1, 챗봇 KB v1(룰베이스)\n  - 관측: Sentry 연결, 핵심 퍼널 이벤트 로깅\n- Phase 2(4주)\n  - 관리자 지표/CSV, 브로드캐스트 이력/철회/감사, 랭킹/환급 CSV, 챗봇 KB 관리 UI, 성능 캐시\n- Phase 3(6~8주)\n  - Redis, OSRM/OR-Tools PoC, 벤더 API(공보물), 정산 양식 자동화, 멀티테넌시 키 도입\n\n---\n\n## 6. Risk Assessment & Mitigation Strategies (상세)\n\n### Technical Risks\n- 지도 SDK 제약/요금: Mapbox 사용량 모니터링, 타일 스타일 캐시 최적화\n- Expo Push 신뢰성: 실패 재시도/토큰 청소, 중요 공지는 SMS 보조\n\n### Performance Risks\n- 선거 직전 트래픽 급증: 읽기 위주 쿼리 튜닝/캐시, 이미지 CDN(S3+CloudFront 선택적)\n- 스케줄러 계산 지연: 사전 배치 계산+후보 설정 바뀔 때만 증분 계산\n\n### Security Risks\n- 파일 위변조: 파일 해시 저장, 서버 측 검증, 원본만 허용\n- RBAC 누락: 컨트롤러 단 권한 가드 유닛 테스트, 최소 권한 접근 원칙\n\n### Integration Risks\n- 외부 API 장애: 폴백(체크리스트 모드), 재시도/서킷브레이커(간단 구현)\n\n### Mitigation\n- ADR로 의사결정 기록, OpenAPI 리그레션 테스트, 로드 테스트(예: k6) 사전 수행\n- 데이터 파기 잡에 대한 E2E 테스트 및 운영 리포트 자동 생성\n\n--- \n\n## Code Organization & Convention (세부 가이드)\n- 도메인 바운디드 컨텍스트: user, profile, task/route, proof, credit/donation, document, broadcast, scheduler, chatbot\n- 공통 타입/스키마: Zod/TS 타입을 /packages/shared에 집중화, 서버 유효성은 Bean Validation(Persistent) 병행\n- API 계약 우선: OpenAPI 스키마에서 TS SDK 자동생성 → 앱/웹 단일 클라이언트 사용\n\n---\n\n## 데이터 계약/모델 맵핑(핵심)\n- Task.type: poi-visit | facility-visit | doc-check | ad-purchase\n- Task.tertiary: defer | proof | nav | open\n- Task.status: planned | started | done | failed\n- Proof.kind: photo | receipt\n- Broadcast.severity: info | warn | critical\n- Profile.intensity: hard | normal | light\n- Profile.religion_pref: none | exclude:[X] | only:[Y]\n- Mobility: car | pickup | trike | bike | walk\n- Credit.kind: in | out | hold\n- Document.kind: nomination | nec_form\n- Document.status: draft | submitted | reviewed | transferred\n\n---\n\n## API 개요(대표)\n- POST /auth/login-sms {phone} → {otpTxId}\n- POST /auth/verify-otp {otpTxId, code} → {jwt, role}\n- GET /schedule/today → {route, tasks[]}\n- POST /tasks/:id/start\n- POST /tasks/:id/complete {proofId?}\n- POST /proofs (multipart init) → {presignedUrl, fields}\n- POST /proofs/confirm {fileMeta,gps,taken_at,hash} → {proofId}\n- POST /chat/ask {text} → {answer, refs, goto}\n- GET /credit/summary → {balance, pendingCount}\n- GET /broadcasts/today → {items[]}\n- GET /docs/checklist → {items[]}\n- POST /admin/broadcasts (admin)\n- POST /admin/proofs/:id/review (admin)\n\n---\n\n## 보안/정책 핵심\n- 인증/인가: SMS OTP + JWT + RBAC(candidate, admin, viewer)\n- 데이터: PII 최소, AES-256(민감 필드), TLS 전송, 감사 로그(열람/다운로드/수정)\n- 증빙: GPS/시간 자동 태깅, 파일 해시 저장, 화이트리스트 검증\n- 보관/파기: 선거 종료+30일 자동 삭제(스케줄 잡), CSV 내보내기 후 별도 보존은 오프라인 정책\n\n---\n\n## 부록: 스케줄러/챗봇 구현 메모(최소주의)\n- 스케줄러 v1\n  - 입력: 시간대, POI 메타, 이벤트, 후보 선호, 과거 성과, 거리/ETA\n  - 점수: 가중 합(시간대/타깃/접근성/다변화/성과/중앙가중치)\n  - 모드: 예비↔후보 가중치 스위치\n  - 근거 시트: 점수 항목별 분해값 반환\n- 챗봇 v1\n  - 룰베이스 키워드/FAQ 매칭, 근거 스니펫 + “자세히 보기” 링크\n  - 모든 답변 로그 저장, 관리자 KB 등록/수정\n\n--- \n\n## 결론\n- 본 TRD는 PRD와 명시된 기술 스택(TypeScript/Next.js, Java Spring + Python, PostgreSQL, 모바일 앱 DB 공용)을 엄수하면서, Spring Boot 단일 게이트웨이 + FastAPI 내부 보조 구조로 최소 복잡도로 목표 기능을 달성한다.\n- MVP는 “오늘의 유세/증빙/챗봇/공지/서류/크레딧 표기”에 집중하고, 확장은 캐시/관측/벤더 연동으로 단계적 추진한다.",
      "writedAt": "2025-09-07T19:12:15.165Z"
    },
    {
      "type": "guideline",
      "content": "# 개혁신당 캠페인 매니저 코드 가이드라인\n\n## 1. 프로젝트 개요\n\n본 문서는 '개혁신당 캠페인 매니저' 프로젝트의 코드 품질, 일관성 및 유지보수성을 확보하기 위한 개발 표준 및 가이드라인을 정의합니다. 프로젝트는 모바일 앱(React Native/Expo)과 웹(Next.js)으로 구성되며, 주 백엔드는 Spring Boot, 보조 백엔드는 FastAPI로 구성된 단일 PostgreSQL 데이터베이스를 공유하는 아키텍처를 채택합니다.\n\n**핵심 아키텍처 결정:**\n*   **단일 데이터 계층**: PostgreSQL + PostGIS를 모든 데이터의 단일 소스로 활용합니다.\n*   **하이브리드 백엔드**: Spring Boot를 주 API 게이트웨이로, FastAPI를 스케줄러/챗봇 등 내부 로직 전담 서비스로 분리하여 운영합니다. 두 백엔드는 내부 REST 통신으로만 연동됩니다.\n*   **클라이언트 단순화**: 모바일 앱과 웹은 Spring Boot API 단일 엔드포인트와만 통신합니다.\n*   **모노레포**: `apps`, `services`, `packages`로 구성된 모노레포 구조를 통해 코드 공유 및 일관성을 확보합니다.\n\n## 2. 핵심 원칙\n\n1.  **명확한 도메인 분리**: 각 도메인(예: 사용자, 과업, 증빙)은 명확히 분리된 책임과 역할을 가져야 합니다.\n2.  **계약 우선 개발**: OpenAPI 스키마를 통해 프런트엔드와 백엔드 간의 API 계약을 최우선으로 정의하고 준수합니다.\n3.  **단일 소유 원칙**: 데이터 마이그레이션(Flyway), 디자인 토큰 등 공유 자원은 단일 소유자를 지정하여 혼란을 방지합니다.\n4.  **성능 및 확장성 고려**: 핵심 API(예: 오늘의 스케줄)는 캐싱 전략을 적용하고, 대량 데이터 처리는 페이징/커서 기반으로 구현합니다.\n5.  **보안 최우선**: 개인 식별 정보(PII)는 최소화하고, 모든 민감 데이터는 암호화하며, RBAC(역할 기반 접근 제어)를 철저히 적용합니다.\n\n## 3. 언어/프레임워크별 가이드라인\n\n### 3.1 TypeScript\n- 앱: React Native 기반\n- 웹: Next.js 기반\n\n*   **파일 구성**:\n    *   `apps/mobile/` 및 `apps/web/` 내에서 기능별(`features/`) 또는 도메인별 디렉토리 구조를 따릅니다.\n    *   `components/`: 재사용 가능한 UI 컴포넌트.\n    *   `hooks/`: 커스텀 React Hooks.\n    *   `services/`: API 클라이언트 및 외부 서비스 연동 로직.\n    *   `store/`: 상태 관리 로직 (Zustand).\n*   **임포트/의존성 관리**:\n    *   절대 경로 임포트를 사용합니다 (예: `@/components/Button`).\n    *   외부 라이브러리 임포트는 파일 상단에 그룹화하고, React 관련 임포트 후, 알파벳 순으로 정렬합니다.\n*   **에러 처리**:\n    *   API 호출 시 `try-catch` 블록을 사용하여 에러를 명시적으로 처리합니다.\n    *   사용자에게 의미 있는 에러 메시지를 제공하고, Sentry를 통해 에러를 로깅합니다.\n\n```typescript\n// MUST: API 호출 에러 처리 예시\nimport { apiClient } from '@/services/api';\nimport { useMutation } from '@tanstack/react-query';\n\ninterface CreateTaskPayload {\n  title: string;\n  description: string;\n}\n\nconst createTask = async (payload: CreateTaskPayload) => {\n  try {\n    const response = await apiClient.post('/tasks', payload);\n    return response.data;\n  } catch (error) {\n    console.error('과업 생성 실패:', error);\n    // 사용자에게 에러 메시지 표시\n    throw new Error('과업 생성에 실패했습니다. 다시 시도해주세요.');\n  }\n};\n\nexport const useCreateTask = () => {\n  return useMutation({\n    mutationFn: createTask,\n    onSuccess: () => {\n      // 성공 시 처리 로직\n      alert('과업이 성공적으로 생성되었습니다.');\n    },\n    onError: (error) => {\n      // 에러 시 처리 로직\n      alert(error.message);\n    },\n  });\n};\n```\n\n```typescript\n// MUST NOT: 에러 처리가 누락되거나 불명확한 경우\n// 에러 발생 시 사용자 경험 저하 및 디버깅 어려움\nconst createTaskBad = async (payload: CreateTaskPayload) => {\n  const response = await apiClient.post('/tasks', payload); // 에러 발생 시 앱 크래시 가능성\n  return response.data;\n};\n```\n\n### 3.2 Java (Spring Boot)\n\n*   **파일 구성**:\n    *   도메인 주도 설계(DDD)를 따르며, `api`(컨트롤러), `app`(서비스), `domain`(엔티티/값 객체), `infra`(리포지토리/외부 연동) 패키지로 분리합니다.\n    *   `src/main/resources/db/migration`: Flyway 마이그레이션 스크립트.\n*   **임포트/의존성 관리**:\n    *   필요한 의존성만 `build.gradle`에 명시하고, 버전 관리를 철저히 합니다.\n    *   클래스 내부에서는 구체적인 구현체 대신 인터페이스를 주입받습니다.\n*   **에러 처리**:\n    *   `@RestControllerAdvice`와 `@ExceptionHandler`를 사용하여 전역적인 예외 처리를 구현합니다.\n    *   HTTP 상태 코드와 함께 의미 있는 에러 응답을 반환합니다.\n\n```java\n// MUST: 전역 예외 처리 예시 (Spring Boot)\npackage com.reform.campaign.common.exception;\n\nimport org.springframework.http.HttpStatus;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.web.bind.MethodArgumentNotValidException;\nimport org.springframework.web.bind.annotation.ExceptionHandler;\nimport org.springframework.web.bind.annotation.RestControllerAdvice;\n\n@RestControllerAdvice\npublic class GlobalExceptionHandler {\n\n    @ExceptionHandler(ResourceNotFoundException.class)\n    public ResponseEntity<ErrorResponse> handleResourceNotFoundException(ResourceNotFoundException ex) {\n        return new ResponseEntity<>(new ErrorResponse(HttpStatus.NOT_FOUND.value(), ex.getMessage()), HttpStatus.NOT_FOUND);\n    }\n\n    @ExceptionHandler(MethodArgumentNotValidException.class)\n    public ResponseEntity<ErrorResponse> handleValidationExceptions(MethodArgumentNotValidException ex) {\n        String errorMessage = ex.getBindingResult().getAllErrors().get(0).getDefaultMessage();\n        return new ResponseEntity<>(new ErrorResponse(HttpStatus.BAD_REQUEST.value(), errorMessage), HttpStatus.BAD_REQUEST);\n    }\n\n    // 기타 예외 처리...\n}\n\n// ErrorResponse.java (별도 파일)\npublic record ErrorResponse(int status, String message) {}\n\n// ResourceNotFoundException.java (별도 파일)\npublic class ResourceNotFoundException extends RuntimeException {\n    public ResourceNotFoundException(String message) {\n        super(message);\n    }\n}\n```\n\n```java\n// MUST NOT: 컨트롤러 내에서 직접 예외를 잡아서 처리 (중복 코드 발생, 일관성 저해)\n@RestController\npublic class TaskController {\n    @GetMapping(\"/tasks/{id}\")\n    public ResponseEntity<Task> getTask(@PathVariable Long id) {\n        try {\n            // 로직\n            return ResponseEntity.ok(task);\n        } catch (Exception e) {\n            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(null);\n        }\n    }\n}\n```\n\n### 3.3 Python (FastAPI)\n\n*   **파일 구성**:\n    *   `app/`: 라우터, 서비스 로직.\n    *   `domain/`: 도메인 모델, Pydantic 스키마.\n    *   `infra/`: 데이터베이스 연동, 외부 API 클라이언트.\n*   **임포트/의존성 관리**:\n    *   `requirements.txt` 또는 `pyproject.toml`을 통해 의존성을 명확히 관리합니다.\n    *   상대 경로 임포트 대신 절대 경로 임포트를 선호합니다.\n*   **에러 처리**:\n    *   FastAPI의 `HTTPException`을 사용하여 표준 HTTP 에러를 반환합니다.\n    *   `@app.exception_handler`를 통해 커스텀 예외 처리를 구현할 수 있습니다.\n\n```python\n# MUST: FastAPI 예외 처리 예시\nfrom fastapi import FastAPI, HTTPException, status\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\nclass Item(BaseModel):\n    name: str\n    price: float\n\nitems_db = {}\n\n@app.post(\"/items/\", response_model=Item)\nasync def create_item(item: Item):\n    if item.name in items_db:\n        raise HTTPException(\n            status_code=status.HTTP_409_CONFLICT,\n            detail=\"Item already exists\"\n        )\n    items_db[item.name] = item\n    return item\n\n@app.get(\"/items/{item_name}\", response_model=Item)\nasync def read_item(item_name: str):\n    if item_name not in items_db:\n        raise HTTPException(\n            status_code=status.HTTP_404_NOT_FOUND,\n            detail=\"Item not found\"\n        )\n    return items_db[item_name]\n```\n\n```python\n# MUST NOT: 예외 발생 시 서버 에러(500)를 반환하는 경우\n# 클라이언트가 에러의 원인을 알기 어려움\n@app.get(\"/items_bad/{item_name}\", response_model=Item)\nasync def read_item_bad(item_name: str):\n    if item_name not in items_db:\n        # 이 경우 500 에러 발생\n        return None \n    return items_db[item_name]\n```\n\n## 4. 코드 스타일 규칙\n\n### MUST Follow:\n\n*   **일관된 명명 규칙**:\n    *   변수/함수: `camelCase` (JS/TS), `snake_case` (Python), `camelCase` (Java).\n    *   클래스/타입: `PascalCase`.\n    *   상수: `SCREAMING_SNAKE_CASE`.\n    *   **근거**: 언어별 관례를 따르면서 가독성을 높이고 혼동을 줄입니다.\n*   **의미 있는 변수/함수명**: 변수와 함수명은 그 목적과 역할을 명확히 설명해야 합니다.\n    *   **근거**: 코드의 자가 문서화를 돕고, 이해도를 높입니다.\n\n```typescript\n// MUST: 의미 있는 변수명\nconst campaignEndDate: Date = new Date('2026-06-01'); // 명확한 목적\nconst calculateRemainingDays = (endDate: Date): number => { /* ... */ }; // 명확한 역할\n```\n\n```typescript\n// MUST NOT: 의미 없는 변수명\nconst d: Date = new Date('2026-06-01'); // 불명확\nconst calc: (d: Date) => number = (d) => { /* ... */ }; // 불명확\n```\n\n*   **코드 포맷팅**: Prettier (TS/JS), Black (Python), Google Java Format (Java)과 같은 자동 포맷터를 사용하고, CI/CD 파이프라인에 통합합니다.\n    *   **근거**: 코드 일관성을 유지하고, 불필요한 코드 리뷰 논쟁을 줄입니다.\n*   **주석 활용**: 복잡한 로직, 비즈니스 규칙, 또는 특정 의사결정의 배경을 설명할 때 주석을 사용합니다. 모든 공개 API 엔드포인트에는 JSDoc/Swagger/Pydantic 독스트링을 작성합니다.\n    *   **근거**: 코드 이해도를 높이고, 협업을 용이하게 합니다.\n\n```java\n// MUST: 의미 있는 주석\n/**\n * 주어진 Task ID에 해당하는 과업을 완료 처리합니다.\n * 과업 완료 시 Proof(증빙)가 필수이며, Proof가 없으면 예외를 발생시킵니다.\n *\n * @param taskId 완료할 과업의 ID\n * @param proofId 과업 완료 증빙 ID (사진, 영수증 등)\n * @return 완료된 Task 객체\n * @throws ResourceNotFoundException Task 또는 Proof를 찾을 수 없을 때\n * @throws IllegalArgumentException Proof가 유효하지 않을 때\n */\npublic Task completeTask(Long taskId, Long proofId) {\n    // ... 로직 구현\n}\n```\n\n```java\n// MUST NOT: 불필요하거나 모호한 주석\npublic Task completeTask(Long taskId, Long proofId) {\n    // 과업을 완료한다.\n    // ... 로직 구현\n}\n```\n\n*   **테스트 코드 작성**: 모든 핵심 비즈니스 로직과 API 엔드포인트에 대해 단위 테스트 및 통합 테스트를 작성합니다.\n    *   **근거**: 코드 변경 시 회귀를 방지하고, 기능의 정확성을 보장합니다.\n\n### MUST NOT Do:\n\n*   **단일 파일에 거대한 모듈 생성**: 수백 줄 이상의 코드를 단일 파일에 작성하거나, 여러 책임을 가진 클래스/함수를 만들지 않습니다.\n    *   **근거**: 응집도를 낮추고 결합도를 높여 유지보수를 어렵게 만듭니다.\n*   **복잡한 상태 관리 패턴 정의**: 프로젝트의 규모에 비해 과도하게 복잡한 상태 관리 패턴(예: 불필요한 Redux 미들웨어 체인)을 도입하지 않습니다.\n    *   **근거**: 학습 곡선을 높이고, 디버깅을 어렵게 만듭니다. Zustand와 React Query의 조합을 권장합니다.\n*   **매직 넘버/문자열 사용**: 코드 내에 의미를 알 수 없는 숫자나 문자열 상수를 직접 사용하지 않고, 명명된 상수로 정의합니다.\n    *   **근거**: 가독성을 저해하고, 변경 시 오류를 유발할 수 있습니다.\n\n```typescript\n// MUST: 명명된 상수 사용\nconst MAX_FILE_SIZE_MB = 5; // 파일 최대 크기\nconst CAMPAIGN_START_DATE = '2025-09-01'; // 캠페인 시작일\n```\n\n```typescript\n// MUST NOT: 매직 넘버/문자열 사용\nconst fileSize = 5; // 5가 무엇을 의미하는지 불명확\nconst startDate = '2025-09-01'; // 문자열 상수로 직접 사용\n```\n\n## 5. 아키텍처 패턴\n\n### 5.1 컴포넌트/모듈 구조 가이드라인\n\n*   **도메인 기반 모듈화**: 각 도메인(예: `tasks`, `proofs`, `users`)은 자체 디렉토리 내에 관련 컴포넌트, 서비스, 타입 등을 포함해야 합니다.\n*   **재사용 가능한 컴포넌트**: `components/` 디렉토리에는 특정 도메인에 종속되지 않고 여러 곳에서 재사용될 수 있는 UI 컴포넌트만 배치합니다.\n*   **백엔드 서비스 분리**: Spring Boot (주 API)와 FastAPI (보조 서비스)는 각각 독립적인 서비스로 배포되며, 내부 REST API를 통해 통신합니다.\n\n### 5.2 데이터 흐름 패턴\n\n*   **단방향 데이터 흐름**: React/Next.js 프런트엔드에서는 단방향 데이터 흐름(Flux/Redux 패턴의 간소화된 형태)을 따릅니다. 상태는 상위 컴포넌트에서 하위 컴포넌트로 프롭스를 통해 전달됩니다.\n*   **API 게이트웨이**: 모든 클라이언트(모바일/웹) 요청은 Spring Boot API 게이트웨이를 통해 이루어집니다. FastAPI는 Spring Boot의 내부 서비스로만 호출됩니다.\n\n```mermaid\ngraph LR\n    User --> MobileApp(모바일 앱)\n    User --> WebApp(웹 앱)\n    MobileApp --> SpringBootAPI(Spring Boot API)\n    WebApp --> SpringBootAPI\n    SpringBootAPI --> PostgreSQL(PostgreSQL DB)\n    SpringBootAPI --> S3(S3 호환 스토리지)\n    SpringBootAPI --> FastAPI(FastAPI 서비스)\n    FastAPI --> PostgreSQL\n    SpringBootAPI --> ExpoPush(Expo Push 서비스)\n    SpringBootAPI --> NaverSENS(네이버 SENS SMS)\n```\n\n### 5.3 상태 관리 컨벤션 (React Native, Next.js)\n\n*   **서버 상태**: `React Query` (또는 TanStack Query)를 사용하여 서버에서 가져온 데이터(캐싱, 동기화, 재요청 등)를 관리합니다.\n*   **클라이언트 상태**: `Zustand`를 사용하여 UI 관련 상태, 사용자 설정 등 클라이언트 전용 상태를 간결하게 관리합니다.\n*   **폼 상태**: `React Hook Form`과 `Zod`를 사용하여 폼의 유효성 검사 및 상태를 관리합니다.\n\n```typescript\n// MUST: React Query와 Zustand 조합 예시\n// useTasks.ts (React Query)\nimport { useQuery } from '@tanstack/react-query';\nimport { apiClient } from '@/services/api';\n\ninterface Task {\n  id: string;\n  title: string;\n  status: 'planned' | 'done';\n}\n\nconst fetchTasks = async (): Promise<Task[]> => {\n  const response = await apiClient.get('/tasks');\n  return response.data;\n};\n\nexport const useTasks = () => {\n  return useQuery<Task[]>({\n    queryKey: ['tasks'],\n    queryFn: fetchTasks,\n  });\n};\n\n// useUserSettings.ts (Zustand)\nimport { create } from 'zustand';\n\ninterface UserSettingsState {\n  isSeniorMode: boolean;\n  toggleSeniorMode: () => void;\n}\n\nexport const useUserSettings = create<UserSettingsState>((set) => ({\n  isSeniorMode: false,\n  toggleSeniorMode: () => set((state) => ({ isSeniorMode: !state.isSeniorMode })),\n}));\n\n// TaskListScreen.tsx (컴포넌트 사용 예시)\nimport React from 'react';\nimport { useTasks } from '@/hooks/useTasks';\nimport { useUserSettings } from '@/store/useUserSettings';\n\nconst TaskListScreen: React.FC = () => {\n  const { data: tasks, isLoading, error } = useTasks();\n  const { isSeniorMode, toggleSeniorMode } = useUserSettings();\n\n  if (isLoading) return <Text>과업 목록을 불러오는 중...</Text>;\n  if (error) return <Text>에러 발생: {error.message}</Text>;\n\n  return (\n    <View>\n      <Switch value={isSeniorMode} onValueChange={toggleSeniorMode} />\n      <Text>{isSeniorMode ? '시니어 모드' : '기본 모드'}</Text>\n      {tasks?.map((task) => (\n        <Text key={task.id}>{task.title} ({task.status})</Text>\n      ))}\n    </View>\n  );\n};\n```\n\n```typescript\n// MUST NOT: 불필요하게 복잡하거나 비효율적인 상태 관리\n// 예를 들어, 모든 API 응답을 전역 상태에 저장하거나, 과도한 리듀서/액션 정의\n// 이는 코드 복잡성을 증가시키고, React Query의 장점을 활용하지 못하게 함\n```\n\n### 5.4 API 디자인 표준\n\n*   **RESTful 원칙 준수**: 자원(Resource) 중심의 API를 설계하고, HTTP 메서드(GET, POST, PUT, DELETE)를 적절히 사용합니다.\n*   **명확한 엔드포인트**: 엔드포인트는 자원을 명확히 나타내야 하며, 복수형 명사를 사용합니다 (예: `/tasks`, `/proofs`).\n*   **버전 관리**: API 버전은 URL에 포함합니다 (예: `/v1/tasks`).\n*   **일관된 응답 형식**: 성공/실패 응답 모두 일관된 JSON 형식을 유지합니다.\n*   **데이터 계약 준수**: `Data Contracts` 섹션에 정의된 키와 값의 스펙을 FE/BE 모두 엄격히 준수합니다.\n\n```json\n// MUST: API 응답 형식 (성공)\n// GET /v1/tasks/{id}\n{\n  \"id\": \"task-123\",\n  \"title\": \"OO역 유세\",\n  \"status\": \"planned\",\n  \"type\": \"poi-visit\",\n  \"scheduled_at\": \"2026-03-15T10:00:00Z\",\n  \"location\": {\n    \"lat\": 37.5665,\n    \"lng\": 126.9780\n  }\n}\n\n// MUST: API 응답 형식 (실패)\n{\n  \"status\": 404,\n  \"message\": \"과업을 찾을 수 없습니다.\",\n  \"code\": \"TASK_NOT_FOUND\" // 선택적: 내부 에러 코드\n}\n```\n\n```json\n// MUST NOT: 일관성 없는 응답 형식\n// GET /v1/tasks/{id}\n// 성공 시: {\"task\": {...}}\n// 실패 시: \"Error: Task not found\" (문자열만 반환)\n```",
      "writedAt": "2025-09-07T19:12:15.165Z"
    },
    {
      "type": "design-guide",
      "content": "# Reform Campaign Manager (비서AI · 캠페인 웹) Design Guide\n\n## 1. Overall Mood (전체적인 무드)\n- Concept: Trustworthy and Professional with a gentle warmth\n- Rationale: Compliance-first workflows (proof with GPS/time, whitelist purchasing, +30 days data deletion) and dual roles (candidates incl. seniors, central admins) demand clarity and credibility. A slight warm accent adds friendliness without sacrificing simplicity.\n- Tone: Cool-neutral base, low–mid saturation, simple and clean. Warmth appears sparingly in accents and empty-states only.\n\n## 2. Reference Service (참조 서비스)\n- Name: Stripe Dashboard (primary reference)\n- Description: Payments and data dashboard focused on clarity and hierarchy\n- Design Mood: Professional, minimal, data legible, low noise\n- Primary Color: #635BFF\n- Secondary Color: #0A2540\n\nBlended cues:\n- GOV.UK Design System for accessibility rigor and compliance clarity\n- Asana for subtle warmth accents (only in empty/help states)\n\n## 3. Color & Gradient (색상 & 그라데이션)\n- Primary Color (Trust Navy): #1F2A44\n- Secondary / Primary Action (Info Blue): #2563EB\n- Accent Warm (Soft Apricot): #FFB36B\n- Success: #16A34A\n- Warning: #F59E0B\n- Critical: #DC2626\n- Grayscale (Cool-neutral)\n  - Text Strong: #0F172A\n  - Text Medium: #334155\n  - Text Subtle: #64748B\n  - Border: #E2E8F0\n  - Surface Alt: #F8FAFC\n  - Background: #FFFFFF\n\nMood\n- Overall: Cool-neutral, low–mid saturation with a very light warm accent\n- Accessibility: Maintain AA 4.5:1 contrast for body text; 3:1 for large headings\n\nColor Usage\n- Navigation/Header/Key titles: Trust Navy (#1F2A44)\n- Primary CTAs/links/highlight actions: Info Blue (#2563EB)\n- Empty/help/celebration micro-moments only: Soft Apricot (#FFB36B), never for body text\n- Status mapping (PRD alignment):\n  - Broadcast.severity info: #2563EB\n  - Broadcast.severity warn: #F59E0B\n  - Broadcast.severity critical: #DC2626\n  - Task.status done: Success (#16A34A)\n  - Task.status failed: Critical (#DC2626)\n- Gradients: Avoid in data-heavy views. Optional subtle hero gradient for marketing/empty shells only (very low opacity)\n\n## 4. Typography & Font (타이포그래피 & 폰트)\n- Font Stack (KR-first, cross-platform):\n  - Primary: Noto Sans KR, Inter\n  - Fallback: Apple SD Gothic Neo, Segoe UI, Roboto, system-ui, sans-serif\n- Type Scale (App/Web shared; Senior mode +2 steps)\n  - H1: 28/36, Semibold\n  - H2: 24/32, Semibold\n  - H3: 20/28, Medium\n  - Body: 16/24, Regular\n  - Small: 14/20, Regular\n  - Caption: 12/16, Regular\n- Emphasis rules:\n  - Use weight and spacing; avoid color-only emphasis\n  - Numbers critical to tasks (ETA, expected contacts) use tabular nums (Inter) for alignment\n\n## 5. Layout & Structure (레이아웃 & 구조)\n- Spacing system: 4/8/12/16/24/32/48 px scale; component radius 8 px; interactive elevation subtle only\n- Mobile App (RN/Expo)\n  - Safe-area margins: 16 px\n  - Bottom nav: max 4 tabs (Today, Dashboard, Chatbot, More)\n  - Home stack: Ribbon → Mini-map overview → 2 TaskCards upfront (infinite list loads on scroll)\n- Web (Next.js)\n  - Grid: 12 columns, container 1200 px, gutter 24 px\n  - Data pages: left filter column (optional 3 cols), content table (9 cols)\n  - Fixed table headers, sticky action bar for approvals\n- Senior Mode\n  - font_scale=large: H2 as primary title on screens; single-card viewport; CTA buttons ≥56 px height; simplified icon density\n\n## 6. Visual Style (비주얼 스타일)\n- Icons: Stroke 1.5 px, monochrome by default (#334155), state color only when necessary (Success/Warning/Critical)\n- Illustrations: Flat minimal line/shape for empty/help states in Soft Apricot accents\n- Map pins: Navy outline, blue fill for active; ETA badge uses Info Blue with white text\n- Photos/Proofs: Square or 4:3 thumbnails with rounded 8 px; show GPS/time meta chips below\n- Ribbons: Full-width top band; severity colors mapped; single-line text with optional “More” link; dismissible\n\n## 7. UX Guide (UX 가이드) — Beginners-first\nAligned with PRD and User Journey.\n\n- Home = Today’s Route focus\n  - Show top broadcast ribbon (info/warn/critical)\n  - Mini-map with route and expected contacts/distance/score summary\n  - Only 2 TaskCards above the fold; more load as user scrolls\n- TaskCard principles (Task.type aligned)\n  - One dominant CTA only: “Start” (poi-visit), “Open” (facility-visit/doc-check/ad-purchase), “Upload” (proof)\n  - Secondary slot maps to Task.tertiary (defer/proof/nav/open) consistently on the right\n  - “Why this place?” opens a short 3-line rationale (TimeMatch, Accessibility, PastPerformance)\n- 3-minute onboarding\n  - Required minimal settings: Profile.intensity, Profile.mobility, Profile.religion_pref (skip allowed)\n  - font_scale detection → auto Senior recommendation\n- Proof upload wizard (3 steps)\n  - 1) Capture/Select → 2) Auto-metadata check (GPS/time) → 3) Submit\n  - Offline queue and auto-resend; status badges (Pending/Retry)\n  - Review results: toast + one-line reason on rejection\n- Chatbot (rule-based)\n  - Starter chips (e.g., “현수막 가능?”, “어깨띠 규정”) → concise answer + basis snippet → [View details] to web policy viewer\n  - Short disclaimer maintained\n- Web redirect clarity\n  - Pre-redirect modal states destination and action (e.g., “You’ll submit a nomination document on web.”)\n- Error/fallback\n  - Scheduler down → checklist mode with brief reason and ETA\n  - Clear retry buttons; keep user progress cached\n- Microcopy (Korean, polite, action-first)\n  - Short verbs (“시작하기”, “업로드 완료”)\n  - Replace jargon: “증빙” → “사진·영수증”\n  - Use user’s name only where necessary; keep tone supportive\n\n## 8. UI Component Guide (UI 컴포넌트 가이드)\n- Buttons\n  - Primary: 48–56 px height; Blue #2563EB bg, white text; radius 8 px\n  - Secondary: Navy #1F2A44 text on white bg with Navy border\n  - Tertiary: Text-only, Blue #2563EB\n  - Destructive: Red #DC2626 bg, white text\n  - Loading: inline spinner; disable with 60% opacity\n- Inputs\n  - Field height 44–48 px; label outside; helper/error text below\n  - Focus border: Blue #2563EB; Error: Red #DC2626\n- TaskCard (App)\n  - Structure: Title → short detail row (ETA, expected contacts) → CTA row\n  - Status chips: planned (Subtle #64748B), started (Blue), done (Green), failed (Red)\n  - Tertiary button slot: “defer/proof/nav/open” per Data Contract\n- Broadcast Ribbon\n  - Info: #2563EB; Warn: #F59E0B; Critical: #DC2626\n  - Left icon + 1-line text + optional “More” link; dismissible\n- Bottom Navigation (App)\n  - Max 4 items; icon 24 px; label 12–13 px; active color Blue; inactive #64748B\n- Map & Pins\n  - Active pin: Blue fill; ETA badge in white text on Blue chip\n  - Route preview uses subtle Blue stroke; reachable POIs dimmed\n- Proof Uploader\n  - Large capture button; thumbnail gallery; GPS/time meta chips auto-filled\n  - Pending/Retry labels; progress indicator; “Submit” fixed at bottom\n- Toast/Snackbar\n  - Success: Green; Warning: Amber; Error: Red; duration 2–3 s; no blocking\n- Tables (Web Admin)\n  - Sticky header, zebra rows (F8FAFC alt)\n  - Status pill colors: Approved(Green), Pending(Amber), Rejected(Red)\n  - Bulk actions in top bar; right drawer for detail review\n\n## 9. Data Contract Mappings (PRD 키 매핑)\n- Task.type → icon + CTA\n  - poi-visit: map-pin icon; CTA “Start”\n  - facility-visit: building/handshake; CTA “Open”\n  - doc-check: document icon; CTA “Open”\n  - ad-purchase: bag/megaphone; CTA “Open”\n- Task.tertiary → right-side action slot\n  - defer | proof | nav | open\n- Task.status → visuals\n  - planned (subtle gray), started (blue outline), done (green), failed (red)\n- Proof.kind → upload preset\n  - photo | receipt, with metadata chips (gps, taken_at, hash)\n- Broadcast.severity → ribbon color\n  - info (#2563EB), warn (#F59E0B), critical (#DC2626)\n- Profile.font_scale=large → Senior UI\n- Credit.kind → ledger badges\n  - in (Green), out (Blue/Navy), hold (Gray/Amber depending on review)\n\n## 10. Accessibility & Internationalization (접근성/국제화)\n- Contrast: AA 4.5:1 for body/minimum; large text AA 3:1\n- Touch targets: ≥48 px; focus rings visible on web\n- Motion: Reduced motion preference respected; limit parallax/animations\n- Language: Default Korean UI copy; English admin labels optional; number formatting with thousands separators\n\n## 11. Empty States, Loading, and Errors (상태별 가이드)\n- Empty\n  - Short encouragement line + one primary action\n  - Soft Apricot accent in small illustration only\n- Loading\n  - Skeletons for lists/cards; progress bars for uploads\n- Errors\n  - Clear cause + recovery action; avoid technical jargon\n  - Offline mode banners and auto-resume for proofs\n\n## 12. Micro-interactions (마이크로 인터랙션)\n- Haptics on primary success/failure in app\n- Subtle fade/elevate on card tap; 120–160 ms transitions\n- Score rationale sheet expands with slide-up; dismiss with swipe-down\n\n## 13. Brand Assets & Do/Don’t (브랜드 운용)\n- Do\n  - Use Navy/Blue for all core flows; reserve Warm accent only for help/empty/celebration\n  - Keep iconography monochrome unless conveying state\n- Don’t\n  - No gradients on data tables; no warm accent on body text\n  - Avoid more than one accent per screen\n\n## 14. Screen Patterns (대표 화면 패턴)\n- App Home (Today)\n  - Ribbon → Mini-map → 2 TaskCards → “View more”\n- Proof Flow\n  - Capture → Auto meta → Submit → Pending badge → Admin result toast\n- Chatbot\n  - Chips → Answer + basis snippet → [View details] to web\n- Admin Web\n  - Candidate list → detail drawer (activities, proofs, documents) → approve/reject with reason → audit log",
      "writedAt": "2025-09-07T19:12:15.165Z"
    },
    {
      "type": "ia",
      "content": "# Reform Campaign Manager (비서AI · 캠페인 웹) Information Architecture (IA)\n\nCaptain, here’s the locked IA reflecting our 3 pillars:\n- Pillar 1: App execution of Today’s Route + Web retrospective intelligence (heatmap, dwell, clusters, rationale snapshot)\n- Pillar 2: Proof upload and credit feedback loop\n- Pillar 3: Admin oversight (approvals, broadcasts, refunds)\nNavigation: Web = sidebar console; App = 4-tab bottom bar\nAuth: Required (SMS OTP → JWT → RBAC)\n\n## 1. Site Map (사이트맵)\n\n- Mobile App (Auth Required)\n  - Today (Home)\n    - Broadcast Ribbon\n    - Mini-map Route Overview\n    - TaskCards (poi-visit, facility-visit, doc-check, ad-purchase)\n    - “Why this place?” rationale sheet\n  - Dashboard\n    - Daily summary (contacts, distance, tasks)\n    - Monthly ranking & credit summary\n  - Chatbot\n    - Q&A → basis snippet → [View details] link to Web Policy Viewer\n  - More\n    - Profile & Preferences (intensity, mobility, religion, font scale)\n    - Proof Upload History\n    - Help & Tutorial\n    - App Settings & Logout\n- Web Admin Console (Auth Required, Sidebar)\n  - Dashboard\n  - Activity Intelligence\n    - Heatmap\n    - Movement Traces\n    - Place Performance\n    - Target Clusters\n    - Rationale Evidence (read-only inputs/weights snapshot)\n  - Candidates\n    - List\n    - Candidate Detail (activities, proofs, documents, credits)\n  - Proofs (Photos/Receipts)\n    - Review Queue\n    - Approved / Rejected\n  - Documents (Nomination / NEC forms)\n    - Submission Inbox\n    - Review & Transfer\n  - Broadcasts\n    - Create / Targeting / History / Revokes\n  - Credits & Donations\n    - Ledgers / Refunds / Exports\n  - Logs & Exports\n  - Settings (Roles, Feature Flags, Policies)\n  - Policy Viewer (linked from App/Chatbot)\n- Auth & Onboarding\n  - Login (Phone verification / SMS OTP)\n  - Onboarding (intensity, mobility, religion, font scale)\n  - Role-based landing (candidate/app, admin/web)\n\nResponsive considerations\n- App: Bottom tabs (max 4). Senior mode: single-card viewport, H2 primary, 56+ px CTAs.\n- Web: Sidebar collapses to icon-only at <=1280 px and to drawer at <=1024 px; data tables horizontal-scroll with fixed headers.\n\n## 2. User Flow (사용자 흐름)\n\n- Candidate: Today’s Route Execution (App)\n  1. Open App → Today tab shows Broadcast Ribbon.\n  2. Review mini-map (expected contacts, distance, score).\n  3. Tap TaskCard (poi-visit) → Start → GPS tracking ON.\n  4. Complete → capture photo/memo → auto GPS/time tag → Submit.\n  5. If facility/doc/ad → Open → pre-redirect notice → proceed to relevant web page when needed.\n  6. View “Why this place?” rationale (TimeMatch, Accessibility, PastPerformance, CentralDirective).\n  7. If scheduler down → checklist fallback.\n\n- Candidate: Proof Upload & Credit Feedback (App → Web sync)\n  1. Start Proof Wizard: Capture/Select.\n  2. Auto-metadata check (GPS/time/hash) → fix if missing.\n  3. Submit → Pending/Retry state visible offline → auto-resend.\n  4. Dashboard shows balance, in/out/hold and pending count; rejection toast with reason and fix link.\n\n- Admin: Retrospective Intelligence (Web)\n  1. Activity Intelligence → Heatmap (time range selector + timeline scrubber).\n  2. Click region → POI list → open POI detail drawer (proofs/photos/notes).\n  3. Move to Movement Traces to view GPS trails + dwell pins.\n  4. Compare Place Performance (exposure vs actual), Target Clusters overlay, Central directives effect.\n  5. Export CSV or map snapshot.\n\n- Admin: Approvals & Broadcasts (Web)\n  1. Proofs → Review Queue (filters, bulk actions).\n  2. Open right drawer → Approve/Reject with reason → audit log saved.\n  3. Documents → review → approve/transfer.\n  4. Broadcasts → compose (severity, targeting) → send → track delivery/reads → revoke if needed.\n  5. Month-end → Credits & Donations → ranking confirm → refunds → export CSV.\n\n- Chatbot → Policy Viewer (App → Web)\n  1. Ask “Is banner at X allowed?” → rule-based answer + basis snippet.\n  2. Tap [View details] → web Policy Viewer with canonical doc and examples.\n\n## 3. Navigation Structure (네비게이션 구조)\n\n- Web (Admin Console): Sidebar (primary), Header (secondary)\n  - Sidebar (persistent): Dashboard, Activity Intelligence (group), Candidates, Proofs, Documents, Broadcasts, Credits & Donations, Logs & Exports, Settings, Policy Viewer.\n  - Header: Page title (Trust Navy), breadcrumbs for nested areas, global search, user menu.\n  - Local filters: Left filter column (optional 3 cols) on data-heavy pages; sticky table headers.\n  - Rationale: Stripe-like data console; many hubs require persistent access and clear scannability.\n\n- Mobile App: Bottom Tab Bar (max 4)\n  - Tabs: Today, Dashboard, Chatbot, More.\n  - Today stack: Ribbon → Mini-map → 2 TaskCards above fold → infinite load on scroll.\n  - Senior mode: larger type (+2 steps), single-card viewport.\n\n- Access control\n  - All routes behind authentication (SMS OTP → JWT → RBAC: candidate, admin, viewer).\n  - Sensitive actions (refunds, revokes) may require re-auth.\n\n## 4. Page Hierarchy (페이지 계층 구조)\n\n- Web (Admin)\n  - / (Dashboard)\n  - /activity\n    - /activity/heatmap\n    - /activity/traces\n    - /activity/places\n    - /activity/clusters\n    - /activity/rationale\n  - /candidates\n    - /candidates/:candidateId\n      - /candidates/:candidateId/activities\n      - /candidates/:candidateId/proofs\n      - /candidates/:candidateId/documents\n      - /candidates/:candidateId/credits\n  - /proofs\n    - /proofs/review\n    - /proofs/approved\n    - /proofs/rejected\n  - /documents\n    - /documents/inbox\n    - /documents/review\n    - /documents/transferred\n  - /broadcasts\n    - /broadcasts/new\n    - /broadcasts/history\n  - /credits\n    - /credits/ledgers\n    - /credits/refunds\n  - /logs\n    - /logs/exports\n  - /settings\n    - /settings/roles\n    - /settings/flags\n    - /settings/policies\n  - /policy/:slug\n- Auth\n  - /auth/login\n  - /auth/verify-otp\n- Mobile App (route names)\n  - app://today\n    - app://today/task/:taskId\n  - app://dashboard\n  - app://chatbot\n  - app://more\n  - app://proofs/:proofId\n  - app://onboarding\n\n## 5. Content Organization (콘텐츠 구성)\n\n| Page | Key Content Elements |\n|---|---|\n| App – Today | Broadcast Ribbon, Mini-map summary (contacts/distance/score), 2 TaskCards above fold, “Why this place?” rationale sheet, Start/Open CTAs |\n| App – Dashboard | Daily counters, charts (contacts, distance, tasks), credit summary (in/out/hold), ranking badge |\n| App – Chatbot | Input, starter chips, answer card with basis snippet, disclaimer, [View details] link |\n| App – Proof Wizard | Stepper (Capture → Meta check → Submit), thumbnails, GPS/time/hash chips, Pending/Retry badges |\n| Web – Dashboard | KPIs (active candidates, pending proofs, broadcasts), trend charts, quick links |\n| Web – Activity Heatmap | Map canvas, heat legend, time range, timeline scrubber, region click → POI list |\n| Web – Movement Traces | Map with GPS trails, dwell-time pins, coverage metrics |\n| Web – Place Performance | Table/cards: POI, exposure score, actual contacts, dwell, proof count, trend sparkline |\n| Web – Target Clusters | Cluster overlays, reach vs plan, directives lift indicators |\n| Web – Candidates | Table with filters; detail drawer/tabs: activities, proofs, documents, credits |\n| Web – Proofs Review | Table (status, kind, taken_at, gps), bulk actions, right drawer (photo, meta, decision) |\n| Web – Documents | Inbox list, template viewer, checklist, approve/transfer with audit |\n| Web – Broadcasts | Composer (severity, target, schedule), delivery/read metrics, revoke history |\n| Web – Credits & Donations | Ledger table, month-end ranking view, refund executor, CSV export |\n| Web – Logs & Exports | Audit log table (who/when/what), export job list |\n| Web – Settings | Roles & permissions, feature flags, policy docs, retention settings |\n| Policy Viewer | Canonical policy doc, related FAQs, version and effective date |\n\nAccessibility notes\n- AA contrast for body text; focus states visible; keyboard navigation for tables and drawer actions.\n- App touch targets ≥48 px; voice-over labels on key CTAs.\n\n## 6. Interaction Patterns (인터랙션 패턴)\n\n- List → Detail Drawer\n  - Tables open a right-side drawer for quick review/approval; preserves context.\n- Sticky Table Header & Bulk Actions\n  - Headers fixed; bulk approve/reject on top bar; filter chips persist.\n- Pre-redirect Notice (App → Web)\n  - Modal explains destination and action before opening web (e.g., “You’ll submit a nomination document on web.”).\n- Proof Upload Wizard (3 steps)\n  - Capture → Auto metadata check → Submit; Pending/Retry; offline queue auto-resend.\n- “Why this place?” Rationale Sheet\n  - 3-line summary (TimeMatch, Accessibility, PastPerformance, CentralDirective).\n- Broadcast Ribbon\n  - Severity colors: info blue, warn amber, critical red; dismissible; More link to full post.\n- Fallback Mode\n  - Scheduler outage → checklist mode with brief reason and ETA; cached progress kept.\n- Infinite Scroll (App TaskCards)\n  - Show 2 items above the fold → load more on scroll; spinner with back-pressure.\n- Approvals Confirmation\n  - Approve/Reject requires reason on Reject; destructive actions double-confirm and re-auth where necessary.\n- Toasts & Snackbars\n  - Success/Warning/Error with consistent colors; short copy; non-blocking.\n\n## 7. URL Structure (URL 구조)\n\nConventions\n- Lowercase, hyphen-separated, nouns first (SEO readable even though behind auth).\n- Resource detail uses IDs or slugs (`/candidates/:candidateId`, `/policy/:slug`).\n- Filters via query params (`?status=pending&date=2025-10-10`).\n- Canonical per page; avoid hash fragments for primary content.\n\nExamples (Web, admin)\n- General: https://console.reform-campaign.kr/\n- Auth: https://console.reform-campaign.kr/auth/login\n- Activity: https://console.reform-campaign.kr/activity/heatmap?range=7d\n- Candidate: https://console.reform-campaign.kr/candidates/abc123/activities\n- Proof review: https://console.reform-campaign.kr/proofs/review?status=pending\n- Broadcast history: https://console.reform-campaign.kr/broadcasts/history\n- Policy viewer: https://console.reform-campaign.kr/policy/whitelist-purchase\n\nDeep links (App)\n- app://task/poi-visit/123\n- app://proofs/987?state=pending\n- app://web-redirect?to=https%3A%2F%2Fconsole.reform-campaign.kr%2Fdocuments%2Freview\n\nSEO best practices (even if private)\n- Semantic titles and headings; descriptive slugs (e.g., policy docs).\n- Open Graph tags for policy pages if ever shared (still gated).\n- Robots noindex on authenticated areas; allow only marketing/front pages if any (none in this scope).\n\nInternationalization\n- Default KR copy; route slugs remain English for consistency. If KR slugs required, map via router aliases.\n\n## 8. Component Hierarchy (컴포넌트 계층 구조)\n\n- Global (App/Web)\n  - Header (Web), Sidebar Nav (Web), Bottom Tab Bar (App), Page Title, Breadcrumbs (Web), Footer (Web minimal), Toast/Snackbar, Modal/Dialog, Spinner/Skeleton\n- Data & Layout\n  - FilterBar, Table (zebra rows, sticky header), Pagination/InfiniteScroll, RightDrawer, ApprovalsStickyBar, StatsCard, ChartMini (sparklines), EmptyState\n- Mapping & Geo\n  - MapCanvas, HeatmapLayer, TraceLayer, Pin/Badge, TimelineScrubber, Legend\n- App-Specific\n  - BroadcastRibbon, MiniMapSummary, TaskCard (poi-visit/facility/doc/ad), RationaleSheet, ProofWizard (Capture, MetaCheck, Submit), CreditSummary, RankingBadge\n- Admin-Specific\n  - CandidateList, CandidateDetailTabs, ProofReviewCard, DocumentChecklist, DocumentViewer, BroadcastComposer, TargetSelector, LedgerTable, RefundExecutor, AuditLogTable, ExportJobList, PolicyDocViewer\n- Inputs & Feedback\n  - Button (Primary/Secondary/Tertiary/Destructive), Input/TextArea, Select/MultiSelect, DateRangePicker, Chips/Badges (status), Tooltip/Popover, ConfirmationDialog\n- Accessibility/Mode\n  - SeniorModeProvider (font scale, single-card toggle), FocusRing, AnnounceRegion (ARIA live)\n\nReusability and tokens\n- Shared design tokens for color, spacing, typography; tabular numerals for key metrics (ETA, counts).\n- State mapping aligned to data contracts (Task.status, Proof.kind, Broadcast.severity, Credit.kind).\n\nResponsive behaviors\n- Sidebar: full → icon-only → drawer across breakpoints (≥1280 / 1024 / <1024).\n- Tables: horizontal scroll with sticky headers; column priority order on narrow screens.\n- Maps: legend collapses into a floating chip group on narrow widths.\n- App Senior Mode: H2 primary titles; single-card viewport; ≥56 px CTAs.\n\n---",
      "writedAt": "2025-09-07T19:12:15.165Z"
    },
    {
      "type": "step-by-step",
      "content": "\n## Core Directive\nYou are a senior software engineer AI assistant. For EVERY task request, you MUST follow the three-phase process below in exact order. Each phase must be completed with expert-level precision and detail.\n\n## Guiding Principles\n- **Minimalistic Approach**: Implement high-quality, clean solutions while avoiding unnecessary complexity\n- **Expert-Level Standards**: Every output must meet professional software engineering standards\n- **Concrete Results**: Provide specific, actionable details at each step\n\n---\n\n## Phase 1: Codebase Exploration & Analysis\n**REQUIRED ACTIONS:**\n1. **Systematic File Discovery**\n   - List ALL potentially relevant files, directories, and modules\n   - Search for related keywords, functions, classes, and patterns\n   - Examine each identified file thoroughly\n\n2. **Convention & Style Analysis**\n   - Document coding conventions (naming, formatting, architecture patterns)\n   - Identify existing code style guidelines\n   - Note framework/library usage patterns\n   - Catalog error handling approaches\n\n**OUTPUT FORMAT:**\n```\n### Codebase Analysis Results\n**Relevant Files Found:**\n- [file_path]: [brief description of relevance]\n\n**Code Conventions Identified:**\n- Naming: [convention details]\n- Architecture: [pattern details]\n- Styling: [format details]\n\n**Key Dependencies & Patterns:**\n- [library/framework]: [usage pattern]\n```\n\n---\n\n## Phase 2: Implementation Planning\n**REQUIRED ACTIONS:**\nBased on Phase 1 findings, create a detailed implementation roadmap.\n\n**OUTPUT FORMAT:**\n```markdown\n## Implementation Plan\n\n### Module: [Module Name]\n**Summary:** [1-2 sentence description of what needs to be implemented]\n\n**Tasks:**\n- [ ] [Specific implementation task]\n- [ ] [Specific implementation task]\n\n**Acceptance Criteria:**\n- [ ] [Measurable success criterion]\n- [ ] [Measurable success criterion]\n- [ ] [Performance/quality requirement]\n\n### Module: [Next Module Name]\n[Repeat structure above]\n```\n\n---\n\n## Phase 3: Implementation Execution\n**REQUIRED ACTIONS:**\n1. Implement each module following the plan from Phase 2\n2. Verify ALL acceptance criteria are met before proceeding\n3. Ensure code adheres to conventions identified in Phase 1\n\n**QUALITY GATES:**\n- [ ] All acceptance criteria validated\n- [ ] Code follows established conventions\n- [ ] Minimalistic approach maintained\n- [ ] Expert-level implementation standards met\n\n---\n\n## Success Validation\nBefore completing any task, confirm:\n- ✅ All three phases completed sequentially\n- ✅ Each phase output meets specified format requirements\n- ✅ Implementation satisfies all acceptance criteria\n- ✅ Code quality meets professional standards\n\n## Response Structure\nAlways structure your response as:\n1. **Phase 1 Results**: [Codebase analysis findings]\n2. **Phase 2 Plan**: [Implementation roadmap]  \n3. **Phase 3 Implementation**: [Actual code with validation]\n",
      "writedAt": "2025-09-07T19:12:15.165Z"
    },
    {
      "type": "clean-code",
      "content": "\n# Clean Code Guidelines\n\nYou are an expert software engineer focused on writing clean, maintainable code. Follow these principles rigorously:\n\n## Core Principles\n- **DRY** - Eliminate duplication ruthlessly\n- **KISS** - Simplest solution that works\n- **YAGNI** - Build only what's needed now\n- **SOLID** - Apply all five principles consistently\n- **Boy Scout Rule** - Leave code cleaner than found\n\n## Naming Conventions\n- Use **intention-revealing** names\n- Avoid abbreviations except well-known ones (e.g., URL, API)\n- Classes: **nouns**, Methods: **verbs**, Booleans: **is/has/can** prefix\n- Constants: UPPER_SNAKE_CASE\n- No magic numbers - use named constants\n\n## Functions & Methods\n- **Single Responsibility** - one reason to change\n- Maximum 20 lines (prefer under 10)\n- Maximum 3 parameters (use objects for more)\n- No side effects in pure functions\n- Early returns over nested conditions\n\n## Code Structure\n- **Cyclomatic complexity** < 10\n- Maximum nesting depth: 3 levels\n- Organize by feature, not by type\n- Dependencies point inward (Clean Architecture)\n- Interfaces over implementations\n\n## Comments & Documentation\n- Code should be self-documenting\n- Comments explain **why**, not what\n- Update comments with code changes\n- Delete commented-out code immediately\n- Document public APIs thoroughly\n\n## Error Handling\n- Fail fast with clear messages\n- Use exceptions over error codes\n- Handle errors at appropriate levels\n- Never catch generic exceptions\n- Log errors with context\n\n## Testing\n- **TDD** when possible\n- Test behavior, not implementation\n- One assertion per test\n- Descriptive test names: `should_X_when_Y`\n- **AAA pattern**: Arrange, Act, Assert\n- Maintain test coverage > 80%\n\n## Performance & Optimization\n- Profile before optimizing\n- Optimize algorithms before micro-optimizations\n- Cache expensive operations\n- Lazy load when appropriate\n- Avoid premature optimization\n\n## Security\n- Never trust user input\n- Sanitize all inputs\n- Use parameterized queries\n- Follow **principle of least privilege**\n- Keep dependencies updated\n- No secrets in code\n\n## Version Control\n- Atomic commits - one logical change\n- Imperative mood commit messages\n- Reference issue numbers\n- Branch names: `type/description`\n- Rebase feature branches before merging\n\n## Code Reviews\n- Review for correctness first\n- Check edge cases\n- Verify naming clarity\n- Ensure consistent style\n- Suggest improvements constructively\n\n## Refactoring Triggers\n- Duplicate code (Rule of Three)\n- Long methods/classes\n- Feature envy\n- Data clumps\n- Divergent change\n- Shotgun surgery\n\n## Final Checklist\nBefore committing, ensure:\n- [ ] All tests pass\n- [ ] No linting errors\n- [ ] No console logs\n- [ ] No commented code\n- [ ] No TODOs without tickets\n- [ ] Performance acceptable\n- [ ] Security considered\n- [ ] Documentation updated\n\nRemember: **Clean code reads like well-written prose**. Optimize for readability and maintainability over cleverness.\n",
      "writedAt": "2025-09-07T19:12:15.165Z"
    }
  ]
}